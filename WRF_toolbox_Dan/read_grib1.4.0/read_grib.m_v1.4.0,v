head	1.2;
access;
symbols;
locks
	bblanton:1.2; strict;
comment	@# @;


1.2
date	2005.09.01.01.45.15;	author bblanton;	state Exp;
branches;
next	1.1;

1.1
date	2005.08.31.14.16.16;	author bblanton;	state Exp;
branches;
next	;


desc
@file as of 31 Aug 2005.
@


1.2
log
@moved functions to private directory
converted ibm2fltmex5.c to matlab code private/ibm2flt.m
general cleanup
@
text
@function grib_struct=read_grib(gribname,irec,varargin)
%READ_GRIB read certain WMO GRiB-formatted binary data files (V1.4.0 - Apr 2004)
% READ_GRIB reads certain WMO GRiB-formatted binary data files 
%
%  Inputs: The first 2 arguments are required:
%          gribname - filename containing GRiB records.
%          irec - specifies which GRiB records to read.
%                 If irec is a vector, it specifies which GRiB records to return.
%                 If irec is a scalar, is specifies how far to read into the GRiB file.
%                 If irec==-1, READ_GRIB reads all records(default). 
%                 Irec can be a CELL ARRAY of parameter names to extract.  
%                 Type read_grib('paramtable') for a list of parameter names. 
%                 Irec can also be the string 'inv{entory}', so that READ_GRIB prints 
%                 a GRiB contents list.
%         
%          READ_GRIB accepts the following property/value pairs:
%
%          HeaderFlag - (0|1) report only headers if==1 (default=1) no data 
%                       structures are returned unless DataFlag==1.
%          DataFlag   - (0|1) return decoded BDS if==1 (default=1).  The data for 
%                       the parameter is stored in the .fltarray field of the structure.
%          ScreenDiag - (0|1) control diagnostics to screen (default=1)
%          ParamTable - ('NCEPOPER'|'NCEPREAN'|'ECMWF128'|'ECMWF160') selects the parameter 
%                       table to use for matching kpds6 number to the correct parameter 
%                       name. (default='NCEPOPER')
%
%          Additional help comments can be obtained by passing one argument to READ_GRIB.  
%          Try: 'mainhelp','paramtableshort','paramtablelong','output_struct'.
%
% Outputs: grib_struct - a MATLAB structure containing the GRiB contents for the requested records.
%                        Call read_grib('output_struct') for a better description.
%
% Call as:grib_struct=read_grib(gribname,irec,p1,v1,p2,v2,...)
%

% Written by Brian Blanton
%            Uni. of North Carolina at Chapel Hill
%            Dept of Marine Sciences
%            Chapel Hill, NC, USA
%            brian_blanton@@unc.edu
%
%            The decoding of the GRiB BDS is done with mex files that use code
%            from wgrib by Wesley Ebisuzaki at NCEP (http://wesley.wwb.noaa.gov).
%            ibm2flt -->> ibm2fltmex5.c  and BDSunpk -->> BDS_unpack_mex5.c
%
% HISTORY: Version 1.2 (Sep 2002):
%          BOB:    pre-2002: first writing
%          BOB:    Jun 2002: added "find_grib_marker" routine to catch info between  
%                            "end_of_grib" marker (7777) and "beginning_of_grib" marker (GRIB).
%          BOB: 06 Sep 2002: fixed bug in HEX2DEC call in INT2 and INT3 functions, used 
%                            in GET_PDS function.  
%                            See comments in INT2. 
%                            Also fixed "Help" code.
%          Version 1.3 (Jun 2003)
%          BOB: 01 Jun 2003: added varargin's, generalized parameter table code, 
%                            added ECMWF 128,160, and NCEPOPER tables.
%          Version 1.3.1 (11 Nov 2003)
%          BOB: 11 Nov 2003: fixed bug in HeaderFlag varargin
%          Version 1.4.0 (1 Apr 2004)
%		   BOB: 01 Apr 2004: Added gds tables for more Data Representation Types (DRT)

global rgversion rgversiondate
rgversion='1.4.0';
rgversiondate=datenum(2005,9,1);

if nargin==0,gribhelp('mainhelp');return,end
if nargin==1,gribhelp(gribname);return,end

%if nargin~=5,error('READ_GRIB must have 0|4 input arguments'),end

if isempty(gribname)
   [fname,fpath]=uigetfile('*','Which GRiB File?');
   if fname==0,return,end
   gribname=[fpath fname];
else
   [fpath,fname,fext,fver]=fileparts(gribname);
   fname=[fname fext];
end

inventory_flag=0;
select_by_param=0;
if isempty(irec)
   irec=-1;
elseif iscell(irec)
   select_by_param=1;
   params_to_get=irec;
   irec=-1;
elseif isstr(irec)
   if strncmp(lower(irec),'inv',3)
      inventory_flag=1;
      ScreenDiag=0;
      dataskip=1;
      irec=-1;
   else
      error('String value for irec MUST be "inventory"')
   end
elseif irec==-1
   % This means get entire GRiB file
else
  [m,n]=size(irec);
  if m~=1&n~=1
     error('Size of irec must be 1xn or nx1')
  end
   irect=irec(:);
   [sirect,irecsort]=sort(irect);
   irect=sirect;
end

% Default propertyname values
HeaderFlag=1;
DataFlag=1;
ScreenDiag=1;
global ParamTable
ParamTable='NCEPOPER';

% Process propertyname/value pairs 
k=1;
while k<length(varargin),
  switch lower(varargin{k}),
    case 'headerflag',
      HeaderFlag=varargin{k+1};
      if ~(HeaderFlag==1 | HeaderFlag==0)
         error('Invalid HeaderFlag to READ_GRIB.')
      end
      varargin([k k+1])=[];
    case 'dataflag',
      DataFlag=varargin{k+1};
      if ~(DataFlag==1 | DataFlag==0)
         error('Invalid DataFlag to READ_GRIB.')
      end
      varargin([k k+1])=[];
    case 'screendiag',
      ScreenDiag=varargin{k+1};
      if ~(ScreenDiag==1 | ScreenDiag==0)
         error('Invalid ScreenDiag to READ_GRIB.')
      end
      varargin([k k+1])=[];
    case 'paramtable',
      ParamTable=varargin{k+1};
      if ~(any(strcmp(ParamTable,{'NCEPOPER','ECMWF160','NCEPREAN','ECMWF128'})))
         error('Invalid Parameter Table to READ_GRIB.')
      end
      varargin([k k+1])=[];
    otherwise
      k=k+2;
  end
end

% Open GRiB file and Find first 'GRIB' string
fid=fopen(gribname,'r');
if fid<0
   error(['GRiB file named ' gribname ' not found.'])
end

if ~is_grib_file(fid,ScreenDiag)
   % No first GRiB marker found. Abort.
   disp('ERROR: READ_GRIB:')
   disp([gribname ' is not a GRiB file.'])
   disp(['No GRiB marker "GRIB" found in file.'])
   grib_struct=-1;
   return
else
   mark1=ftell(fid);
   fseek(fid,0,-1);   % rewind the GRiB file
   % The -4 is because of the first GRIB marker found previously.
   if mark1>4
      gribfileheader=fread(fid,mark1-4);
   else
      gribfileheader=[];      
   end
   % Report pre-firstmarker header if length <= 90
   if(mark1<91)
      if ScreenDiag,disp(['GRiB header = ' char(gribfileheader')]);,end
   else
      % Reposition fid to point just before "G" char
      fseek(fid,-4,0);
   end
end

first4octets=fread(fid,4);
if ScreenDiag,
disp(char(first4octets'));,end

if inventory_flag
   inventory_str=sprintf('###################################################\n');
   inventory_str=[inventory_str sprintf('Inventory for GRiB file %s \n',fname)];
   inventory_str=[inventory_str sprintf('###################################################\n')];
   inventory_str=[inventory_str sprintf('\n')];
   inventory_str=[inventory_str sprintf(...
   '           Parameter\n')];
   inventory_str=[inventory_str sprintf(...
   '  Rec #  #    Name  Units              Date    Hr Mn   P1    P2  Quantity                Level           IC        Grid     Description\n')];
   inventory_str=[inventory_str sprintf(...
   '--------------------------------------------------------------------------------------------------------------------------\n')];
end

% initialization
grec=0;crec=0;
fpos=ftell(fid);
global Parameter_Table  

Set_Parameter_Table(ParamTable);

% Each record in a GRiB file contains sections 0-5, possibly with 
% sections 2,3 (GDS,BMS) omitted.  Basically, each GRIB record 
% contains a parameter (weather model variable like U_FLX)
% and definitions of the model grid, etc.  So the size of the 
% grib_struct will increase with each new record. 

grib_struct=[];

while ~isempty(first4octets)

   oct1to4=char(first4octets');

   % Make sure first 4 octets are "GRIB"
   if ~strcmp(oct1to4,'GRIB')
   
      % scanning for next grib marker
      iret=find_grib_marker(fid,ScreenDiag);
      if iret<1 & feof(fid)
         if ScreenDiag
	    str=sprintf('\n%s\n',['End of file reached.']);
            disp(str)
	 end
         return
      end
   end      

   grec=grec+1;
   this_one_extracted=0;
   
   if ScreenDiag,fprintf(1,'GRec=%4d : FPos1=%8d',grec,fpos),end
   
   % read section 0, the IS (Indicator Section);
   % this is always extracted
   oct5to7=fread(fid,3);
   lengrib=bitshift3(oct5to7(1),oct5to7(2),oct5to7(3));
   edition=fread(fid,1);

   % Edition check
   if edition~=1
      str=sprintf('\n%s\n',['READ_GRIB cannot read edition ' int2str(edition) ' GRiB records.']);
      str=[str sprintf('%s\n',['Edition ' int2str(edition) ' detected at record ' int2str(grec) ' in ' fname]);];
      disp(str)
      grib_struct=[];
      return
   end
   
   % Determine if this is a record to skip or keep
   headerskip=1;dataskip=1;
   if select_by_param
      % Look forward into the PDS of the current GRiB 
      % record to see what parameter this is
      current_fpos=ftell(fid);
      oct1to3=fread(fid,3);
      lenpds=bitshift3(oct1to3(1),oct1to3(2),oct1to3(3));
      fseek(fid,-3,0);
      pds=fread(fid,lenpds);
      param=Get_Parameter(pds(9),1);
      if any(strcmp(param,params_to_get))
          %"any(strcmp(param,params_to_get))" equivalent to "ismember(param,params_to_get)"
          headerskip=0;
          if DataFlag,dataskip=0;end
          crec=crec+1;     
      end
      fseek(fid,current_fpos,-1);
  elseif irec(1)==-1
      headerskip=0;
      if DataFlag,dataskip=0;end
      crec=crec+1;     
  else
      idx=find(irect==grec);
      if ~isempty(idx)
          headerskip=0;
          if DataFlag,dataskip=0;end
          crec=crec+1;
          irect(find(irect==sirect(crec)))=[];
      end
  end
  
  if headerskip & dataskip
      % Skip GRiB record, except for '7777' delimiter at end;
      % We've already read in 8 octets!!
      fseek(fid,lengrib-12,0);
   else
      [pds_struct,gds_struct,bms_struct,bds_struct,dataarray]=...
           extract_grib(fid,grec,fpos,headerskip,dataskip);
      % Package current grib records into returning grib_struct
      grib_struct(crec).sec1_1=oct1to4;
      grib_struct(crec).lengrib=lengrib;
      grib_struct(crec).edition=edition;
      grib_struct(crec).file=gribname;
      grib_struct(crec).record=grec;
      grib_struct(crec).description=pds_struct.description;
      temp1=pds_struct.parameter;
      [temp2,temp3]=table3a(pds_struct.pdsvals(10));
      grib_struct(crec).parameter=pds_struct.parameter;
      grib_struct(crec).layer=temp3;
      grib_struct(crec).units=pds_struct.units;
      dtime=datenum(2000+pds_struct.year,pds_struct.month,pds_struct.day,pds_struct.hour,pds_struct.min,00);
      grib_struct(crec).stime=datestr(dtime);
      % 14 Jun 2002: BOB: added level to output struct
      grib_struct(crec).level=levels(pds_struct.pdsvals(10),pds_struct.pdsvals(11),pds_struct.pdsvals(12));
      grib_struct(crec).gridtype=gds_struct.DRT;
      grib_struct(crec).pds=pds_struct;
      grib_struct(crec).gds=gds_struct;
      grib_struct(crec).bms=bms_struct;
      grib_struct(crec).bds=bds_struct;
      grib_struct(crec).fltarray=dataarray;
      this_one_extracted=1;
      if inventory_flag
         clear grib_struct;
         crec=0;  % Reset structure logging
	 minute=['0' int2str(pds_struct.min)];
	 if pds_struct.min>9,minute=int2str(pds_struct.minute);,end
	 hour=['0' int2str(pds_struct.hour)];
	 if pds_struct.hour>9,hour=int2str(pds_struct.hour);,end
	 day=['0' int2str(pds_struct.day)];
	 if pds_struct.day>9,day=int2str(pds_struct.day);,end
	 month=['0' int2str(pds_struct.month)];
	 if pds_struct.month>9,month=int2str(pds_struct.month);,end
         level=levels(pds_struct.pdsvals(10),pds_struct.pdsvals(11),pds_struct.pdsvals(12));
	 l=length(level);lm=floor(l/2);ll=1:lm;lr=lm+1:l;
	 level_left=level(ll);level_right=level(lr);
	 inventory_str=[inventory_str sprintf(...
	            '%4d    %3d %6s  %-14s  %2d%2d/%2s/%2s %2s %2s %5.1f %5.1f %-16s %9s%-9s  %10s %10s %-s\n',...
	            grec,...
		    pds_struct.pdsvals(9),...
		    pds_struct.parameter,...
		    pds_struct.units,...
	            pds_struct.century-1,...
		    pds_struct.year,...
		    month,day,hour,minute,...
		    pds_struct.P1,pds_struct.P2,pds_struct.TRI,level_left,level_right,...
		    pds_struct.IC,gds_struct.DRT(1:8),...
		    pds_struct.description)];
      end
   end   
   
   % The last 4 octets (bytes) should contain the ascii chars 55;
   % this is the string '7777' end-of-grib record delimiter.
   end_grib_delim=char(fread(fid,4)');

   % Get file pointer position 
   fpos=ftell(fid);
   if ScreenDiag
      fprintf(1,' : GLen=%8d : FPos2=%8d : EOGRiB=%4s',lengrib,fpos,end_grib_delim)
      if ~this_one_extracted
         fprintf(1,'\n')
      else
         fprintf(1,' ***\n')
      end

   end
   if ~strcmp(end_grib_delim,'7777')
      disp(['Alignment problem reading GRiB message ' gribname])
      disp(['at GRiB record number ' int2str(grec)])
      disp(['Should be at the end of GRiB record, and we''re  not.'])
      disp(['Returning from READ_GRIB with GRiB up to this point.'])
      return
%BOB      error('read_grid alignment problem a')   
   end
   
   % Read the next 4 octets, which SHOULD be the beginning of the next GRIB record
   first4octets=fread(fid,4);
end

if exist('irecsort'),grib_struct=grib_struct(irecsort);,end
if inventory_flag
      helpwin(inventory_str,'Inventory',['Inventory for ' gribname]);
      grib_struct=[];
end

% close grib stream
fclose(fid);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% PRIVATE FUNCTIONS %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% EXTRACT GRiB RECORD %%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [pds_struct,gds_struct,bms_struct,bds_struct,dataarray]=...
         extract_grib(fid,nrec,fpos,headerskip,dataskip)

   % read section 1, the PDS (Product Definition Section)
   oct1to3=fread(fid,3);
   lenpds=bitshift3(oct1to3(1),oct1to3(2),oct1to3(3));
   fseek(fid,-3,0);
   pds_struct=get_pds(fid,lenpds);

   % read section 2, the GDS (Grid Definition Section)
   if pds_struct.HASGDS
      oct1to3=fread(fid,3);
      lengds=bitshift3(oct1to3(1),oct1to3(2),oct1to3(3));
      fseek(fid,-3,0);
      gds_struct=get_gds(fid,lengds);
   else
      gds_struct=[];
   end
   
   % read section 3, the BMS (Bit Map Section)
   if pds_struct.HASBMS
      oct1to3=fread(fid,3);
      lenbms=bitshift3(oct1to3(1),oct1to3(2),oct1to3(3));
      fseek(fid,-3,0);
      bms_struct=get_bms(fid,lenbms);
   else
      bms_struct.bitmap=uint8([]);
   end
  
   % read section 4, the MANDATORY BDS (Binary Data Section)
   oct1to3=fread(fid,3);
   lenbds=bitshift3(oct1to3(1),oct1to3(2),oct1to3(3));
   fseek(fid,-3,0);
   if ~dataskip
      bds_struct=get_bds(fid,lenbds);
   else
      bds_struct=[];
      fseek(fid,lenbds,0);
   end
 
   % It's time to decode the binary data in bds_struct.bindata
   if ~dataskip
      decimal_sf=10^(-pds_struct.DecSF);
      bin_sf=2^(bds_struct.bsfE);
      if isfield(gds_struct,'Ni')
         nxny=gds_struct.Ni*gds_struct.Nj; % Gaussian, etc, Grids
      else
         nxny=gds_struct.Nx*gds_struct.Ny; % Lambert Grids, etc.
      end
      fac1=decimal_sf*bds_struct.RefVal;
      fac2=decimal_sf*bin_sf;
      dataarray=BDS_unpack_mex5(bds_struct.bindata,...
				bms_struct.bitmap,...
				bds_struct.nbits,...
				nxny,fac1,fac2);
   else
      dataarray=[];
   end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% GET THE BDS STRUCTURE %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function bds_struct=get_bds(fid,lenbds)

bds=fread(fid,11);
bds_struct.len=lenbds;
bds_struct.oct4=bds(4);
bds_struct.bsfE=int2(bds(5),bds(6));
%bds_struct.RefVal=ibm2fltmex5(bds(7:10));
bds_struct.RefVal=ibm2flt(bds(7:10));
bds_struct.nbits=bds(11);

bds=fread(fid,lenbds-11);
bds_struct.bindata=uint8(bds);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% GET THE GDS STRUCTURE %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function gds_struct=get_gds(fid,lengds)
gds=fread(fid,lengds);
gds_struct.len=lengds;
gds_struct.NV=gds(4);
gds_struct.PV=gds(5);
gds_struct.DRT=table6(gds(6));
if gds(6)==201
   error(['DRT ARAWAKA semi-staggered E-GRID grid type not yet supported.'])
end
if gds(6)==202
   error(['DRT ARAWAKA filled E-GRID grid type not yet supported.'])
end

% 01 Apr 2004: BOB GDS table D (Sundry Grid Definitions)

switch gds_struct.DRT
   case 'Lambert Conf.'
      % For Lambert Conformal Grids
      % GDS Octets 7-42
      gds_struct.Nx=bitshift2(gds(7),gds(8));
      gds_struct.Ny=bitshift2(gds(9),gds(10));
      gds_struct.La1=int3(gds(11),gds(12),gds(13))/1000;
      gds_struct.Lo1=int3(gds(14),gds(15),gds(16))/1000;
      gds_struct.rcf=gds(17);
      gds_struct.LOV=int3(gds(18),gds(19),gds(20))/1000;
      gds_struct.Dx=int3(gds(21),gds(22),gds(23))/1000;
      gds_struct.Dy=int3(gds(24),gds(25),gds(26))/1000;
      gds_struct.Latin1=int3(gds(29),gds(30),gds(31))/1000;
      gds_struct.Latin2=int3(gds(32),gds(33),gds(34))/1000;
      gds_struct.Lat_of_SP=int3(gds(35),gds(36),gds(37))/1000;
      gds_struct.Lon_of_SP=int3(gds(38),gds(39),gds(40))/1000;

 case {'Gaussian Lat/Lon' , 'Equidis. Cyl. Lat/Lon'}
      % For Gaussian Grids and some others.
      % GDS Octets 7-32
      gds_struct.Ni=bitshift2(gds(7),gds(8));
      gds_struct.Nj=bitshift2(gds(9),gds(10));
      gds_struct.La1=int3(gds(11),gds(12),gds(13))/1000;
      gds_struct.Lo1=int3(gds(14),gds(15),gds(16))/1000;
      gds_struct.rcf=gds(17);
      gds_struct.La2=int3(gds(18),gds(19),gds(20))/1000;
      gds_struct.Lo2=int3(gds(21),gds(22),gds(23))/1000;
      gds_struct.Di=bitshift2(gds(24),gds(25))/1000;
      gds_struct.N=bitshift2(gds(26),gds(27));
      gds_struct.smf=gds(28);
      gds_struct.oct29to32=gds(29:32);                                          

   otherwise
      error(['DRT ' int2str(gds(6)) ' not yet coded.'])
end

gds_struct.gdsvals=gds;


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% GET THE BMS STRUCTURE %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function bms_struct=get_bms(fid,lenbms)
bms=fread(fid,lenbms);
bms_struct.len=lenbms;
bms_struct.NUnused_Bits=bms(4);
bms_struct.oct5=bms(5);
bms_struct.oct6=bms(6);
bms_struct.bitmap=uint8(bms(7:lenbms));
bms_struct.bmsvals=bms;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% GET THE PDS STRUCTURE %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pds_struct=get_pds(fid,lenpds)

pds=fread(fid,lenpds);%read the whole pds into memory

pds_struct.len=lenpds;              % the length of pds
pds_struct.PTV=pds(4);              % parameter table version number 
pds_struct.IC=table0(pds(5));       % identification of center(table0)
pds_struct.GenProcID=pds(6);        % generating process ID mumber(allocated by the originating center),table A
pds_struct.GridID=pds(7);           % grid identification (geographical location and area, defined by the originating center,table B
temp=table1(pds(8));                % flag specifying the presence or abscence of GDS or a BMS; table 1
pds_struct.HASGDS=temp(1);
pds_struct.HASBMS=temp(2);
pds_struct.parameter=Get_Parameter(pds(9),1);   % parameter name
pds_struct.units=Get_Parameter(pds(9),3);       % parameter units
pds_struct.description=Get_Parameter(pds(9),2); % parameter description
[layerstr,layerabbrev]=table3a(pds(10));        %indicator of type of level of layer, table 3 & 3a

if ~iscell(layerstr)
   pds_struct.layer=sprintf('%d - %s [%s]',int2str(pds(10)),layerstr,layerabbrev);
else
   pds_struct.layer=layerstr;
end

%pds_struct.layer=[int2str(pds(10)) ' - ' layerstr ' [' layerabbrev ']'];
pds_struct.h_p_etc=pds(11:12);    % height, pressure,etc. of the level or layer,table 3
pds_struct.year=pds(13);
pds_struct.month=pds(14);
pds_struct.day=pds(15);
pds_struct.hour=pds(16);
pds_struct.min=pds(17);
pds_struct.fcast_time_unit=table4(pds(18));
pds_struct.P1=pds(19);
pds_struct.P2=pds(20);
pds_struct.TRI=table5(pds(21));
pds_struct.TRI_N=bitshift2(pds(22),pds(23));
pds_struct.TRI_Nmissing=pds(24);
pds_struct.century=pds(25);
pds_struct.SubCID=pds(26);
pds_struct.DecSF=int2(pds(27),pds(28));
pds_struct.pdsvals=pds;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLES FOR Product Definition Section (PDS)      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE 0, PDS Octet 5                             %
% National/International Originating Centers       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function orig_center=table0(ival)
switch ival
   case  1, orig_center='Melbourne (WMC)';
   case  2, orig_center='Melbourne (WMC)';
   case  4, orig_center='Moscow (WMC)';
   case  5, orig_center='Moscow (WMC)';
   case  7, orig_center='NCEP (WMC)';
   case  8, orig_center='NWSTG (WMC)';
   case  9, orig_center='Other (WMC)';
   case  34, orig_center='Japan. Met. Soc. (RSMC)';
   case  52, orig_center='Nat. Hurr. Center, Miami';
   case  53, orig_center='Can. Meteor. Serv.-Montreal (RSMC)';
   case  57, orig_center='US Air Force-Global Weather Center';
   case  58, orig_center='US Navy-FNOC';
   case  59, orig_center='NOAA Forecast Systems Lab. (Boulder)';
   case 60, orig_center='NCAR, Boulder';
   case 74, orig_center='U.K. Met Office - Bracknell';
   case 85, orig_center='French Weather Service - Toulouse';
   case 97, orig_center='European Space Agency (ESA)';
   case 98, orig_center='ECMWF - Reading';
   case 99, orig_center='DeBilt, Netherlands';
   otherwise, orig_center='N/A';
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE A, PDS Octet 6                             %
% Orig Center #7 (NCEP) Generating Process/Model   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function gen_proc=tableA(ival)
switch ival
   case 02, gen_proc='Ultra Violet Index Model';
   case 05, gen_proc='Satellite Derived Precipitation and temperatures, from IR';
   case 10, gen_proc='Global Wind-Wave Forecast Model';
   case 19, gen_proc='Limited-area Fine Mesh (LFM) analysis';
   case 25, gen_proc='Snow Cover Analysis';
   case 30, gen_proc='Forecaster generated field';
   case 31, gen_proc='Value added post processed field';
   case 39, gen_proc='Nested Grid forecast Model (NGM)';
   case 42, gen_proc='Global Optimum Interpolation Analysis (GOI) from AVN run';
   case 43, gen_proc='Global Optimum Interpolation Analysis (GOI) from "Final" run';
   case 44, gen_proc='Sea Surface Temperature Analysis';
   case 45, gen_proc='Coastal Ocean Circulation Model';
   case 49, gen_proc='Ozone Analysis from TIROS Observations';
   case 52, gen_proc='Ozone Analysis from Nimbus 7 Observations';
   case 53, gen_proc='LFM-Fourth Order Forecast Model';
   case 64, gen_proc='Regional Optimum Interpolation Analysis (ROI)';
   case 68, gen_proc='80 wave tri., 18-layer Spec. model from AVN run';
   case 69, gen_proc='80 wave tri., 18 layer Spec. model from MRF run';
   case 70, gen_proc='Quasi-Lagrangian Hurricane Model (QLM)';
   case 73, gen_proc='Fog Forecast model - Ocean Prod. Center';
   case 74, gen_proc='Gulf of Mexico Wind/Wave';
   case 75, gen_proc='Gulf of Alaska Wind/Wave';
   case 76, gen_proc='Bias corrected MRF';
   case 77, gen_proc='126 wave tri., 28 layer spec. model from AVN run';
   case 78, gen_proc='126 wave tri., 28 layer spec. model from MRF run';
   case 79, gen_proc='Backup from the previous run';
   case 80, gen_proc='62 wave triangular, 28 layer Spectral model from MRF run';
   case 81, gen_proc='Spectral Statistical Interpolation (SSI) anal from AVN run';
   case 82, gen_proc='Spectral Statistical Interpolation (SSI) anal from "Final" run';
   case 83, gen_proc='MESO ETA Model - Backup Version (currently 80 km)';
   case 84, gen_proc='MESO ETA Model (currently 32 km)';
   case 85, gen_proc='No longer used';
   case 86, gen_proc='RUC Model, from FSL (isentropic; scale: 60km at 40N)';
   case 87, gen_proc='CAC Ensemble Forecasts from Spectral (ENSMB)';
   case 88, gen_proc='Ocean Wave model with additional physics (PWAV)';
   case 90, gen_proc='62 wave tri., 28 layer spec. model extension of MRF run';
   case 91, gen_proc='62 wave tri., 28 layer spec. model extension of AVN run';
   case 92, gen_proc='62 wave tri., 28 layer spec. model run from MRF final analysis';
   case 93, gen_proc='62 wave tri., 28 layer spec. model run from T62 GDAS anal of MRF run';
   case 94, gen_proc='T170/L42 Global Spectral Model from MRF Run';
   case 95, gen_proc='T126/L42 Global Spectral Model from MRF Run';
   case 96, gen_proc='Aviation Model (currently T170/L42 Global Spectral Model)';
   case 100, gen_proc='RUC Surface Analysis (scale: 60km at 40N)';
   case 101, gen_proc='RUC Surface Analysis (scale: 40km at 40N)';
   case 105, gen_proc='RUC Model from FSL (isentropic; scale: 40km at 40N)';
   case 110, gen_proc='ETA Model - 15km version';
   case 150, gen_proc='NWS River Forecast System (NWSRFS)';
   case 151, gen_proc=' NWS Flash Flood Guidance System (NWSFFGS)';
   case 152, gen_proc='WSR-88D Stage II Precipi Anal';
   case 153, gen_proc='WSR-88D Stage III Precip Anal';
   otherwise, gen_proc='N/A';
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE 1, PDS Octet 8                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function ret=table1(ival)
bval=dec2bin(ival);
if strcmp(bval(1),'0'),ret=0;,end
if strcmp(bval(1),'1'),ret=1;,end
if strcmp(bval(2),'0'),ret=[ret 0];,end
if strcmp(bval(2),'1'),ret=[ret 1];,end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE 3a, PDS Octet 10  (Special Levels)         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [ret1,ret2]=table3a(ival)
ret2='';
switch ival
   case 1,   ret1='Surface';                            ret2='SFC';
   case 2,   ret1='Cloud Base Level';                   ret2='CBL';
   case 3,   ret1='Cloud Top Level';                    ret2='CTL';
   case 4,   ret1='Level of 0 deg (C) isotherm';        ret2='0DEG';
   case 5,   ret1='Level of Adiabatic Condensation';    ret2='ADCL';
   case 6,   ret1='Maximum wind level';                 ret2='MWSL';
   case 7,   ret1='Tropopause';                         ret2='TRO';
   case 8,   ret1='Nominal Top of Atmos';               ret2='NTAT';
   case 9,   ret1='Sea Bottom';                         ret2='SEAB';
   case 20,  ret1='Isothermal level';                   ret2='TMPL';
   case 100, ret1='Isobaric surface Pressure in hPa (2 octets)'; 
   case 101, ret1={'Layer between two isobaric surfaces','Pressure of top in kPa','Pressure of bottom in kPa'};
   case 102, ret1='Mean sea level 0';
   case 103, ret1={'Specified altitude above mean sea level','Altitude in meters (2 octets)'};
   case 104, ret1={'Layer between two specified altitudes above mean sea level','Altitude of top in hm','Altitude of bottom in hm'};
   case 105, ret1={'Specified height above ground','Height in meters (2 octets)'};
   case 106, ret1={'Layer between two specified height levels above ground','Height of top in hm','Height of bottom in hm'};
   case 107, ret1={'Sigma level','Sigma value in 1/10000 (2 octets)'};
   case 108, ret1={'Layer between two sigma levels','Sigma value of top in 1/100','Sigma value of bottom in 1/100'};
   case 109, ret1={'Hybrid level','Level number (2 octets)'};
   case 110, ret1={'Layer between two hybrid levels','Level number of top','Level number of bottom'};
   case 111, ret1={'Departmenth below land surface','Departmenth in centimeters (2 octets)'};
   % NCEP Special levels and Layers'
   case 204, ret1='Highest tropospheric freezing level';ret2='HTFL';
   case 209, ret1='Boundary layer cloud bottom level '; ret2='BCBL';
   case 210, ret1='Boundary layer cloud top level';     ret2='BCTL';
   case 211, ret1='Boundary layer cloud layer';         ret2='BCY';
   case 212, ret1='Low cloud bottom level';             ret2='LCBL';
   case 213, ret1='Low cloud top level';                ret2='LCTL';
   case 214, ret1='Low cloud layer';                    ret2='LCY';
   case 222, ret1='Middle cloud bottom level';          ret2='MCBL';
   case 223, ret1='Middle cloud top level';             ret2='MCTL';
   case 224, ret1='Middle cloud layer';                 ret2='MCY';
   case 232, ret1='High cloud bottom level';            ret2='HCBL';
   case 233, ret1='High cloud top level';               ret2='HCTL';
   case 234, ret1='High cloud layer';                   ret2='HCY';
   case 242, ret1='Convective cloud bottom level';      ret2='CCBL';
   case 243, ret1='Convective cloud top level';         ret2='CCTL';
   case 244, ret1='Convective cloud layer';             ret2='CCY';
   otherwise, ret1='Reserved';ret2='';   
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE 4, PDS (Section 1) Octet 18                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function time_unit=table4(ival)
switch ival
   case  0,time_unit='minute';
   case  1, time_unit='hour';
   otherwise,time_unit='none';
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE 5, PDS (Section 1) Octet 21                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function tri_string=table5(ival)
switch ival
   case  0,tri_string='Valid at P1';
   case  1,tri_string='Anal Prod for P1';
   case  2,tri_string='P1<Valid<P2';
   case  3,tri_string='Average';
   case  4,tri_string='Accumulation';
   case  5,tri_string='Difference';
   case  51,tri_string='Clim. Mean Value';
   otherwise,tri_string='N/A';
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE 6, GDS (Section 2) Octet 6                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function Dat_Rep_Type=table6(ival)
switch ival
   case 0,Dat_Rep_Type='Equidis. Cyl. Lat/Lon';
   case 1,Dat_Rep_Type='Mercator';
   case 2,Dat_Rep_Type='Gnomic';
   case 3,Dat_Rep_Type='Lambert Conf.';
   case 4,Dat_Rep_Type='Gaussian Lat/Lon';
   case 5,Dat_Rep_Type='Polar Stereogrphic';
   case 13,Dat_Rep_Type='Oblique Lambert Conf.';
   case 50,Dat_Rep_Type='Spher. Harm. Coeff';
   case 90,Dat_Rep_Type='Space View';
   otherwise, Dat_Rep_Type='Reserved';
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fetch Parameter from Parameter_Table             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function parameter=Get_Parameter(ival,idx)
global Parameter_Table
parameter=char(Parameter_Table{ival+1}(idx));

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% levels                                            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function lev=levels(oct10,oct11,oct12)

k=bitshift2(oct11,oct12);

switch(oct10)
   case 1,lev='surface';
   case 2,lev= 'cloud base';
   case 3,lev= 'cloud top';
   case 4,lev= '0C isotherm';
   case 5,lev= 'cond lev';
   case 6,lev= 'max wind lev';
   case 7,lev= 'tropopause';
   case 8,lev= 'nom. top';
   case 9,lev= 'sea bottom';
   case 10,lev='atmos col';
   case 100, lev=sprintf('%d mb',k);
   case 101, lev=sprintf('%d-%d mb',oct11*10,oct12*10);
   case 102, lev=sprintf('MSL');
   case 103, lev=sprintf('%d m above MSL',k);
   case 104, lev=sprintf('%d-%d m above msl',oct11*100,oct12*100);
   case 105, lev=sprintf('%d m above gnd',k);
   case 106, lev=sprintf('%d-%d m above gnd',oct11*100,oct12*100);
   case 107, lev=sprintf('sigma=%.4f',k/10000.0);
   case 108, lev=sprintf('sigma %.2f-%.2f',oct11/100.0,oct12/100.0);
   case 109, lev=sprintf('hybrid lev %d',k);
   case 110, lev=sprintf('hybrid %d-%d',oct11,oct12);
   case 111, lev=sprintf('%d cm down',k);
   case 112, lev=sprintf('%d-%d cm down',oct11,oct12);
   case 113, lev=sprintf('%dK',k);
   case 114, lev=sprintf('%d-%dK',475-oct11,475-oct12);
   case 115, lev=sprintf('%d mb above gnd',k);
   case 116, lev=sprintf('%d-%d mb above gnd',oct11,oct12);
   case 121, lev=sprintf('%d-%d mb',1100-oct11,1100-oct12);
   case 212, lev=sprintf('low cld bot');
   case 213, lev=sprintf('low cld top');
   case 214, lev=sprintf('low cld lay');
   case 222, lev=sprintf('mid cld bot');
   case 223, lev=sprintf('mid cld top');
   case 224, lev=sprintf('mid cld lay');
   case 232, lev=sprintf('high cld bot');
   case 233, lev=sprintf('high cld top');
   case 234, lev=sprintf('high cld lay');
   otherwise,lev='unknown';   
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% gribhelp                                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function gribhelp(option)
global rgversion ParamTable

switch lower(option)
   case 'mainhelp'
      disp('READ_GRIB Main help section')
      str={'READ_GRIB is a set of MATLAB functions to process weather',...
           'model output files, distributed in the WMO GRiB format.  This',...
           'format is a very compact, machine independent binary that',...
           'allows exchange of meteorological model products around',...
           'the modeling community.',...
           '',...
           'The general procedure is to inventory a GRiB file with',...
           'read_grib(gribname,''invent'') to identify which records are to',...
           'be extracted.  Then, use READ_GRIB to extract specific',...
           'records.  Alternatively, READ_GRIB can accept a list of',...
           'parameter names to extract, by using read_grib(gribname,list)',...
           'where list is a cell array containing parameter names.',...
           'For example, read_grib("grib_file",{''UFLX'',''VFLX'',''PRES''},...) ',...
           'will extract from the GRiB file "grib_file" the records ',...
           'that have parameter names UFLX, VFLX, and PRES. Be ',...
           'advised that more than one GRiB record can have the same ',...
           'parameter NAME, as the pressure denoted by the parameter ',...
           'name PRES can be provided at several atmospheric levels.',...
           '',...
           'Extraction by other GRiB information is not yet possible.',...
           '',...
           'Call READ_GRIB with the following "help" arguments for more',...
           'information:',...
           '''mainhelp'',''paramtableshort'',''paramtablelong'',''output_struct'''};
	   str=str';
     
      title1=['READ_GRIB V' rgversion ' General Help'];

   case 'paramtableshort'
      Set_Parameter_Table(ParamTable);
      disp('READ_GRIB Parameter Table section')
      str=[];
      k=-1;
      for i=1:85
         for j=1:3
	    k=k+1;         
            str=[str sprintf('Param %3d --> %6s  :  ',k,Get_Parameter(k,1))];
         end
       str=[str sprintf(' \n')];
      end
      str=[str sprintf('Param %3d = %6s   ',255,Get_Parameter(255,1))]; 
      title1=['READ_GRIB V' rgversion ' GRiB Parameter Table, Short  Version'];
   case 'paramtablelong'
      Set_Parameter_Table(ParamTable);
      disp('READ_GRIB Parameter Table section, Long Version')
      str=sprintf('           Parameter\n');
      str=[str sprintf('Number   Name  Units             Description\n')];
      str=[str sprintf('---------------------------------------------------------\n')];
      for k=0:255
         str=[str sprintf(' %3d   %6s | %-14s | %-s\n',...
	 k,Get_Parameter(k,1),Get_Parameter(k,3),Get_Parameter(k,2))];
      end
      title1=['READ_GRIB V' rgversion ' GRiB Parameter Table, Long Version'];
   case 'output_struct'
      
      str={'READ_GRIB returns the requested GRiB records in the',...
           'form of an array of structure.  This array contains one',...
	   'structure per GRiB record.',...
	   '',...
	   'Each structure has the following fields, with examples given',...
	   'to the right of the colons:',...
           '         sec1_1: ''GRIB''',...
           '        lengrib: 109524',...
           '        edition: 1',...
           '           file: ''gdas1.T00Z.SFLUXGrbF06''',...
           '         record: 1',...
           '    description: ''Zonal momentum flux''',...
           '      parameter: ''UFLX''',...
           '          units: ''N/m^2''',...
           '       gridtype: ''Gaussian Lat/Lon''',...
           '            pds: [1x1 struct]',...
           '            gds: [1x1 struct]',...
           '            bms: [1x1 struct]',...
           '            bds: [1x1 struct]',...
           '       fltarray: [72960x1 double]',...
	   '',...
	   'This particular grib_struct example contains the Zonal momentum',...
	   'flux from record # 1 of the GRiB file gdas1.T00Z.SFLUXGrbF06.',...
	   'The UFLX units are N/m^2, and the grid is Gaussian.  The actual',...
	   'data is contained in the field fltarray, in which there is ',...
	   'one value per gaussian grid piont.  See the OPNML/MATLAB routine',...
	   'GAUSS2LL to convert this gaussian data to lon/lat points.',...
	   '',...
	   'There is much more info in the pds,gds,bms,and bds structures, but',...
           'see the GRiB manual for more information on the contents of these',...
	   'sections.'};
	   str=str';
      title1=['READ_GRIB V' rgversion ' Output Structure Help'];
   otherwise
      disp('READ_GRIB must be called with a valid help string.')
      disp('Try: ''mainhelp'',''paramtableshort'',''paramtablelong'',''output_struct''') 
      return
end

if ~isempty(str)
%   BOB 6 Sep, 2002: 
   helpwin(str,title1);
%   msgbox(str,title1,'replace');
end

% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Test to see if fid points to a real GRiB File     %
% Added Jun 2002 to fix an issue with certain       %
% REANALYSIS GRiB files.                            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function iret=is_grib_file(fid,ScreenDiag)
nope=1;
iret=0;
if ScreenDiag
   disp('Searching for first GRIB marker...')
end

iret=find_grib_marker(fid,ScreenDiag);
if iret>0,iret=1;,end


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Scan for GRiB Marker (GRIB)                       %
% Added Jun 2002 to fix an issue with certain       %
% REANALYSIS GRiB files.                            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function iret=find_grib_marker(fid,ScreenDiag)

current_position=ftell(fid);

nope=1;
iret=0;

while nope
   gribmarker=fread(fid,4);
   if ~isempty(gribmarker)&length(gribmarker)==4
      if strcmp(char(gribmarker'),'GRIB')
	 % GRIB marker found

	 if ScreenDiag
     	    str=sprintf('GRiB Record marker "GRIB" found at chars %d-%d',...
     			ftell(fid)-3,ftell(fid));
     	    disp(str);
	 end
	 iret=ftell(fid);
	 break
      else
	 fseek(fid,-3,0);
      end 
   else
      % eof reached
      iret=0;
      nope=0;
      break
   end
end 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% GRiB Edition 1 Parameter Table, copped from WGRIB %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function Set_Parameter_Table(ParamTable)
global Parameter_Table 

switch ParamTable
   case 'NCEPOPER'
      Parameter_Table={...
      {'var0','undefined',''},...
      {'PRES','Pressure ','Pa'},...				       
      {'PRMSL','Pressure reduced to MSL ','Pa'},...		       
      {'PTEND','Pressure tendency ','Pa/s'},...		       
      {'PVORT','Pot. vorticity ','km^2/kg/s'},...		       
      {'ICAHT','ICAO Standard Atmosphere Reference Height ','M'},... 
      {'GP','Geopotential ','m^2/s^2'},...			       
      {'HGT','Geopotential height ','gpm'},...		       
      {'DIST','Geometric height ','m'},...			       
      {'HSTDV','Std dev of height ','m'},...  		       
      {'TOZNE','Total ozone ','Dobson'},...
      {'TMP','Temp. ','K'},...
      {'VTMP','Virtual temp. ','K'},...
      {'POT','Potential temp. ','K'},...
      {'EPOT','Pseudo-adiabatic pot. temp. ','K'},...
      {'TMAX','Max. temp. ','K'},...
      {'TMIN','Min. temp. ','K'},...
      {'DPT','Dew point temp. ','K'},...
      {'DEPR','Dew point depression ','K'},...
      {'LAPR','Lapse rate ','K/m'},...
      {'VIS','Visibility ','m'},...
      {'RDSP1','Radar spectra (1) ','non-dim'},...
      {'RDSP2','Radar spectra (2) ','non-dim'},...
      {'RDSP3','Radar spectra (3) ','non-dim'},...
      {'PLI','Parcel lifted index (to 500 hPa) ','K'},...
      {'TMPA','Temp. anomaly ','K'},...
      {'PRESA','Pressure anomaly ','Pa'},...
      {'GPA','Geopotential height anomaly ','gpm'},...
      {'WVSP1','Wave spectra (1) ','non-dim'},...
      {'WVSP2','Wave spectra (2) ','non-dim'},...
      {'WVSP3','Wave spectra (3) ','non-dim'},...
      {'WDIR','Wind direction ','deg'},...
      {'WIND','Wind speed ','m/s'},...
      {'UGRD','u wind ','m/s'},...
      {'VGRD','v wind ','m/s'},...
      {'STRM','Stream function ','m^2/s'},...
      {'VPOT','Velocity potential ','m^2/s'},...
      {'MNTSF','Montgomery stream function ','m^2/s^2'},...
      {'SGCVV','Sigma coord. vertical velocity ','/s'},...
      {'VVEL','Pressure vertical velocity ','Pa/s'},...
      {'DZDT','Geometric vertical velocity ','m/s'},...
      {'ABSV','Absolute vorticity ','/s'},...
      {'ABSD','Absolute divergence ','/s'},...
      {'RELV','Relative vorticity ','/s'},...
      {'RELD','Relative divergence ','/s'},...
      {'VUCSH','Vertical u shear ','/s'},...
      {'VVCSH','Vertical v shear ','/s'},...
      {'DIRC','Direction of current ','deg'},...
      {'SPC','Speed of current ','m/s'},...
      {'UOGRD','u of current ','m/s'},...
      {'VOGRD','v of current ','m/s'},...
      {'SPFH','Specific humidity ','kg/kg'},...
      {'RH','Relative humidity ','%'},...
      {'MIXR','Humidity mixing ratio ','kg/kg'},...
      {'PWAT','Precipitable water ','kg/m^2'},...
      {'VAPP','Vapor pressure ','Pa'},...
      {'SATD','Saturation deficit ','Pa'},...
      {'EVP','Evaporation ','kg/m^2'},...
      {'CICE','Cloud Ice ','kg/kg'},...
      {'PRATE','Precipitation rate ','kg/m^2/s'},...
      {'TSTM','Thunderstorm probability ','%'},...
      {'APCP','Total precipitation ','kg/m^2'},...
      {'NCPCP','Large scale precipitation ','kg/m^2'},...
      {'ACPCP','Convective precipitation ','kg/m^2'},...
      {'SRWEQ','Snowfall rate water equiv. ','kg/m^2/s'},...
      {'WEASD','Accum. snow ','kg/m^2'},...
      {'SNOD','Snow depth ','m'},...
      {'MIXHT','Mixed layer depth ','m'},...
      {'TTHDP','Transient thermocline depth ','m'},...
      {'MTHD','Main thermocline depth ','m'},...
      {'MTHA','Main thermocline anomaly ','m'},...
      {'TCDC','Total cloud cover ','%'},...
      {'CDCON','Convective cloud cover ','%'},...
      {'LCDC','Low level cloud cover ','%'},...
      {'MCDC','Mid level cloud cover ','%'},...
      {'HCDC','High level cloud cover ','%'},...
      {'CWAT','Cloud water ','kg/kg'},...
      {'BLI','Best lifted index (to 500 hPa) ','K'},...
      {'SNOC','Convective snow ','kg/m^2'},...
      {'SNOL','Large scale snow ','kg/m^2'},...
      {'WTMP','Water temp. ','K'},...
      {'LAND','Land cover (land=1;sea=0) ','fraction'},...
      {'DSLM','Deviation of sea level from mean ','m'},...
      {'SFCR','Surface roughness ','m'},...
      {'ALBDO','Albedo ','%'},...
      {'TSOIL','Soil temp. ','K'},...
      {'SOILM','Soil moisture content ','kg/m^2'},...
      {'VEG','Vegetation ','%'},...
      {'SALTY','Salinity ','kg/kg'},...
      {'DEN','Density ','kg/m^3'},...
      {'WATR','Water runoff ','kg/m^2'},...
      {'ICEC','Ice concentration (ice=1;no ice=0) ','fraction'},...
      {'ICETK','Ice thickness ','m'},...
      {'DICED','Direction of ice drift ','deg'},...
      {'SICED','Speed of ice drift ','m/s'},...
      {'UICE','u of ice drift ','m/s'},...
      {'VICE','v of ice drift ','m/s'},...
      {'ICEG','Ice growth rate ','m/s'},...
      {'ICED','Ice divergence ','/s'},...
      {'SNOM','Snow melt ','kg/m^2'},...
      {'HTSGW','Sig height of wind waves and swell ','m'},...
      {'WVDIR','Direction of wind waves ','deg'},...
      {'WVHGT','Sig height of wind waves ','m'},...
      {'WVPER','Mean period of wind waves ','s'},...
      {'SWDIR','Direction of swell waves ','deg'},...
      {'SWELL','Sig height of swell waves ','m'},...
      {'SWPER','Mean period of swell waves ','s'},...
      {'DIRPW','Primary wave direction ','deg'},...
      {'PERPW','Primary wave mean period ','s'},...
      {'DIRSW','Secondary wave direction ','deg'},...
      {'PERSW','Secondary wave mean period ','s'},...
      {'NSWRS','Net short wave (surface) ','W/m^2'},...
      {'NLWRS','Net long wave (surface) ','W/m^2'},...
      {'NSWRT','Net short wave (top) ','W/m^2'},...
      {'NLWRT','Net long wave (top) ','W/m^2'},...
      {'LWAVR','Long wave ','W/m^2'},...
      {'SWAVR','Short wave ','W/m^2'},...
      {'GRAD','Global radiation ','W/m^2'},...
      {'BRTMP','Brightness temperature ','K'},...
      {'LWRAD','Radiance with respect to wave no. ','W/m/sr'},...
      {'SWRAD','Radiance with respect ot wave len. ','W/m^3/sr'},...
      {'LHTFL','Latent heat flux ','W/m^2'},...
      {'SHTFL','Sensible heat flux ','W/m^2'},...
      {'BLYDP','Boundary layer dissipation ','W/m^2'},...
      {'UFLX','Zonal momentum flux ','N/m^2'},...
      {'VFLX','Meridional momentum flux ','N/m^2'},...
      {'WMIXE','Wind mixing energy ','J'},...
      {'IMGD','Image data ',''},...
      {'MSLSA','Mean sea level pressure (Std Atm) ','Pa'},...
      {'MSLMA','Mean sea level pressure (MAPS) ','Pa'},...
      {'MSLET','Mean sea level pressure (ETA model) ','Pa'},...
      {'LFTX','Surface lifted index ','K'},...
      {'4LFTX','Best (4-layer) lifted index ','K'},...
      {'KX','K index ','K'},...
      {'SX','Sweat index ','K'},...
      {'MCONV','Horizontal moisture divergence ','kg/kg/s'},...
      {'VWSH','Vertical speed shear ','1/s'},...
      {'TSLSA','3-hr pressure tendency (Std Atmos Red) ','Pa/s'},...
      {'BVF2','Brunt-Vaisala frequency^2 ','1/s^2'},...
      {'PVMW','Potential vorticity (mass-weighted) ','1/s/m'},...
      {'CRAIN','Categorical rain ','yes=1;no=0'},...
      {'CFRZR','Categorical freezing rain ','yes=1;no=0'},...
      {'CICEP','Categorical ice pellets ','yes=1;no=0'},...
      {'CSNOW','Categorical snow ','yes=1;no=0'},...
      {'SOILW','Volumetric soil moisture ','fraction'},...
      {'PEVPR','Potential evaporation rate ','W/m^2'},...
      {'CWORK','Cloud work function ','J/kg'},...
      {'U-GWD','Zonal gravity wave stress ','N/m^2'},...
      {'V-GWD','Meridional gravity wave stress ','N/m^2'},...
      {'PV','Potential vorticity ','m^2/s/kg'},...
      {'COVMZ','Covariance between u and v ','m^2/s^2'},...
      {'COVTZ','Covariance between u and T ','K*m/s'},...
      {'COVTM','Covariance between v and T ','K*m/s'},...
      {'CLWMR','Cloud water ','kg/kg'},...
      {'O3MR','Ozone mixing ratio ','kg/kg'},...
      {'GFLUX','Ground heat flux ','W/m^2'},...
      {'CIN','Convective inhibition ','J/kg'},...
      {'CAPE','Convective Avail. Pot. Energy ','J/kg'},...
      {'TKE','Turbulent kinetic energy ','J/kg'},...
      {'CONDP','Lifted parcel condensation pressure ','Pa'},...
      {'CSUSF','Clear sky upward solar flux ','W/m^2'},...
      {'CSDSF','Clear sky downward solar flux ','W/m^2'},...
      {'CSULF','Clear sky upward long wave flux ','W/m^2'},...
      {'CSDLF','Clear sky downward long wave flux ','W/m^2'},...
      {'CFNSF','Cloud forcing net solar flux ','W/m^2'},...
      {'CFNLF','Cloud forcing net long wave flux ','W/m^2'},...
      {'VBDSF','Visible beam downward solar flux ','W/m^2'},...
      {'VDDSF','Visible diffuse downward solar flux ','W/m^2'},...
      {'NBDSF','Near IR beam downward solar flux ','W/m^2'},...
      {'NDDSF','Near IR diffuse downward solar flux ','W/m^2'},...
      {'RWMR','Rain water mixing ratio ','kg/kg'},...
      {'SNMR','Snow mixing ratio ','kg/kg'},...
      {'MFLX','Momentum flux ','N/m^2'},...
      {'LMH','Mass point model surface ','non-dim'},...
      {'LMV','Velocity point model surface ','non-dim'},...
      {'MLYNO','Model layer number (from bottom up) ','non-dim'},...
      {'NLAT','Latitude (-90 to +90) ','deg'},...
      {'ELON','East longitude (0-360) ','deg'},...
      {'ICMR','Ice mixing ratio ','kg/kg'},...
      {'GRMR','Graupel mixing ratio ','kg/kg'},...
      {'GUST','Surface wind gust ','m/s'},...
      {'LPSX','x-gradient of log pressure ','1/m'},...
      {'LPSY','y-gradient of log pressure ','1/m'},...
      {'HGTX','x-gradient of height ','m/m'},...
      {'HGTY','y-gradient of height ','m/m'},...
      {'TURB','Turbulence SIGMET/AIRMET ','non-dim'},...
      {'ICNG','Icing SIGMET/AIRMET ','non-dim'},...
      {'LTNG','Lightning ','non-dim'},...
      {'DRIP','Rate of water dropping from canopy to gnd ','kg/m^2'},...
      {'VPTMP','Virtual pot. temp. ','K'},...
      {'HLCY','Storm relative helicity ','m^2/s^2'},...
      {'PROB','Prob. from ensemble ','non-dim'},...
      {'PROBN','Prob. from ensemble norm. to clim. expect. ','non-dim'},...
      {'POP','Prob. of precipitation ','%'},...
      {'CPOFP','Prob. of frozen precipitation ','%'},...
      {'CPOZP','Prob. of freezing precipitation ','%'},...
      {'USTM','u-component of storm motion ','m/s'},...
      {'VSTM','v-component of storm motion ','m/s'},...
      {'NCIP','No. concen. ice particles ',''},...
      {'EVBS','Direct evaporation from bare soil ','W/m^2'},...
      {'EVCW','Canopy water evaporation ','W/m^2'},...
      {'ICWAT','Ice-free water surface ','%'},...
      {'CWDI','Convective weather detection index ',''},...
      {'VAFTAD','VAFTAD?? ','??'},...
      {'DSWRF','Downward short wave flux ','W/m^2'},...
      {'DLWRF','Downward long wave flux ','W/m^2'},...
      {'UVI','Ultra violet index (1 hour centered at solar noon) ','J/m^2'},...
      {'MSTAV','Moisture availability ','%'},...
      {'SFEXC','Exchange coefficient ','(kg/m^3)(m/s)'},...
      {'MIXLY','No. of mixed layers next to surface ','integer'},...
      {'TRANS','Transpiration ','W/m^2'},...
      {'USWRF','Upward short wave flux ','W/m^2'},...
      {'ULWRF','Upward long wave flux ','W/m^2'},...
      {'CDLYR','Non-convective cloud ','%'},...
      {'CPRAT','Convective precip. rate ','kg/m^2/s'},...
      {'TTDIA','Temp. tendency by all physics ','K/s'},...
      {'TTRAD','Temp. tendency by all radiation ','K/s'},...
      {'TTPHY','Temp. tendency by non-radiation physics ','K/s'},...
      {'PREIX','Precip index (0.0-1.00) ','fraction'},...
      {'TSD1D','Std. dev. of IR T over 1x1 deg area ','K'},...
      {'NLGSP','Natural log of surface pressure ','ln(kPa)'},...
      {'HPBL','Planetary boundary layer height ','m'},...
      {'5WAVH','5-wave geopotential height ','gpm'},...
      {'CNWAT','Plant canopy surface water ','kg/m^2'},...
      {'SOTYP','Soil type (Zobler) ','0..9'},...
      {'VGTYP','Vegetation type (as in SiB) ','0..13'},...
      {'BMIXL','Blackadars mixing length scale ','m'},...
      {'AMIXL','Asymptotic mixing length scale ','m'},...
      {'PEVAP','Pot. evaporation ','kg/m^2'},...
      {'SNOHF','Snow phase-change heat flux ','W/m^2'},...
      {'5WAVA','5-wave geopot. height anomaly ','gpm'},...
      {'MFLUX','Convective cloud mass flux ','Pa/s'},...
      {'DTRF','Downward total radiation flux ','W/m^2'},...
      {'UTRF','Upward total radiation flux ','W/m^2'},...
      {'BGRUN','Baseflow-groundwater runoff ','kg/m^2'},...
      {'SSRUN','Storm surface runoff ','kg/m^2'},...
      {'SIPD','Supercooled large droplet (SLD) icing pot. diagn. ',''},...
      {'O3TOT','Total ozone ','kg/m^2'},...
      {'SNOWC','Snow cover ','%'},...
      {'SNOT','Snow temp. ','K'},...
      {'COVTW','Covariance T and w ','K*m/s'},...
      {'LRGHR','Large scale condensation heating ','K/s'},...
      {'CNVHR','Deep convective heating ','K/s'},...
      {'CNVMR','Deep convective moistening ','kg/kg/s'},...
      {'SHAHR','Shallow convective heating ','K/s'},...
      {'SHAMR','Shallow convective moistening ','kg/kg/s'},...
      {'VDFHR','Vertical diffusion heating ','K/s'},...
      {'VDFUA','Vertical diffusion zonal accel ','m/s^2'},...
      {'VDFVA','Vertical diffusion meridional accel ','m/s^2'},...
      {'VDFMR','Vertical diffusion moistening ','kg/kg/s'},...
      {'SWHR','Solar radiative heating ','K/s'},...
      {'LWHR','Longwave radiative heating ','K/s'},...
      {'CD','Drag coefficient ','non-dim'},...
      {'FRICV','Friction velocity ','m/s'},...
      {'RI','Richardson number ','non-dim'},...
      {'var255','undefined',''}};

   case 'NCEPREAN'
      Parameter_Table={...
      {'var0',    'undefined',''},...
      {'PRES',    'Pressure','Pa'},...
      {'PRMSL',   'Pressure reduced to MSL','Pa'},...
      {'PTEND',   'Pressure tendency','Pa/s'},...
      {'var4',    'undefined',''},...
      {'var5',    'undefined',''},...
      {'GP',      'Geopotential','m^2/s^2'},...
      {'HGT',     'Geopotential height','gpm'},...
      {'DIST',    'Geometric height','m'},...
      {'HSTDV',   'Std dev of height','m'},...
      {'HVAR',   'Variance of height','m^2'},...
      {'TMP',    'Temp.','K'},...
      {'VTMP',   'Virtual temp.','K'},...
      {'POT',    'Potential temp.','K'},...
      {'EPOT',   'Pseudo-adiabatic pot. temp.','K'},...
      {'TMAX',   'Max. temp.','K'},...
      {'TMIN',   'Min. temp.','K'},...
      {'DPT',    'Dew point temp.','K'},...
      {'DEPR',   'Dew point depression','K'},...
      {'LAPR',   'Lapse rate','K/m'},...
      {'VISIB',  'Visibility','m'},...
      {'RDSP1',  'Radar spectra (1)','non-dim'},...
      {'RDSP2',  'Radar spectra (2)','non-dim'},...
      {'RDSP3',  'Radar spectra (3)','non-dim'},...
      {'var24',  'undefined',''},...
      {'TMPA',   'Temp. anomaly','K'},...
      {'PRESA',  'Pressure anomaly','Pa'},...
      {'GPA',    'Geopotential height anomaly','gpm'},...
      {'WVSP1',  'Wave spectra (1)','non-dim'},...
      {'WVSP2',  'Wave spectra (2)','non-dim'},...
      {'WVSP3',  'Wave spectra (3)','non-dim'},...
      {'WDIR',   'Wind direction','deg'},...
      {'WIND',   'Wind speed','m/s'},...
      {'UGRD',   'u wind','m/s'},...
      {'VGRD',   'v wind','m/s'},...
      {'STRM',   'Stream function','m^2/s'},...
      {'VPOT',   'Velocity potential','m^2/s'},...
      {'MNTSF',  'Montgomery stream function','m^2/s^2'},...
      {'SGCVV',  'Sigma coord. vertical velocity','/s'},...
      {'VVEL',   'Pressure vertical velocity','Pa/s'},...
      {'DZDT',   'Geometric vertical velocity','m/s'},...
      {'ABSV',   'Absolute vorticity','/s'},...
      {'ABSD',   'Absolute divergence','/s'},...
      {'RELV',   'Relative vorticity','/s'},...
      {'RELD',   'Relative divergence','/s'},...
      {'VUCSH',  'Vertical u shear','/s'},...
      {'VVCSH',  'Vertical v shear','/s'},...
      {'DIRC',   'Direction of current','deg'},...
      {'SPC',    'Speed of current','m/s'},...
      {'UOGRD',  'u of current','m/s'},...
      {'VOGRD',  'v of current','m/s'},...
      {'SPFH',   'Specific humidity','kg/kg'},...
      {'RH',     'Relative humidity','%'},...
      {'MIXR',   'Humidity mixing ratio','kg/kg'},...
      {'PWAT',   'Precipitable water','kg/m^2'},...
      {'VAPP',   'Vapor pressure','Pa'},...
      {'SATD',   'Saturation deficit','Pa'},...
      {'EVP',    'Evaporation','kg/m^2'},...
      {'CICE',   'Cloud Ice','kg/m^2'},...
      {'PRATE',  'Precipitation rate','kg/m^2/s'},...
      {'TSTM',   'Thunderstorm probability','%'},...
      {'APCP',   'Total precipitation','kg/m^2'},...
      {'NCPCP',  'Large scale precipitation','kg/m^2'},...
      {'ACPCP',  'Convective precipitation','kg/m^2'},...
      {'SRWEQ',  'Snowfall rate water equiv.','kg/m^2/s'},...
      {'WEASD',  'Accum. snow','kg/m^2'},...
      {'SNOD',   'Snow depth','m'},...
      {'MIXHT',  'Mixed layer depth','m'},...
      {'TTHDP',  'Transient thermocline depth','m'},...
      {'MTHD',   'Main thermocline depth','m'},...
      {'MTHA',   'Main thermocline anomaly','m'},...
      {'TCDC',   'Total cloud cover','%'},...
      {'CDCON',  'Convective cloud cover','%'},...
      {'LCDC',   'Low level cloud cover','%'},...
      {'MCDC',   'Mid level cloud cover','%'},...
      {'HCDC',   'High level cloud cover','%'},...
      {'CWAT',   'Cloud water','kg/m^2'},...
      {'var77',  'undefined',''},...
      {'SNOC',   'Convective snow','kg/m^2'},...
      {'SNOL',   'Large scale snow','kg/m^2'},...
      {'WTMP',   'Water temp.','K'},...
      {'LAND',   'Land-sea mask','1=l; 0=s'},...
      {'DSLM',   'Deviation of sea level from mean','m'},...
      {'SFCR',   'Surface roughness','m'},...
      {'ALBDO',  'Albedo','%'},...
      {'TSOIL',  'Soil temp.','K'},...
      {'SOILM',  'Soil moisture content','kg/m^2'},...
      {'VEG',    'Vegetation','%'},...
      {'SALTY',  'Salinity','kg/kg'},...
      {'DEN',    'Density','kg/m^3'},...
      {'RUNOF',  'Runoff','kg/m^2'},...
      {'ICEC',   'Ice concentration','ice=1;no ice=0'},...
      {'ICETK',  'Ice thickness','m'},...
      {'DICED',  'Direction of ice drift','deg'},...
      {'SICED',  'Speed of ice drift','m/s'},...
      {'UICE',   'u of ice drift','m/s'},...
      {'VICE',   'v of ice drift','m/s'},...
      {'ICEG',   'Ice growth rate','m/s'},...
      {'ICED',   'Ice divergence','/s'},...
      {'SNOM',   'Snow melt','kg/m^2'},...
      {'HTSGW',  'Sig height of wind waves and swell','m'},...
      {'WVDIR',  'Direction of wind waves','deg'},...
      {'WVHGT',  'Sig height of wind waves','m'},...
      {'WVPER',  'Mean period of wind waves','s'},...
      {'SWDIR',  'Direction of swell waves','deg'},...
      {'SWELL',  'Sig height of swell waves','m'},...
      {'SWPER',  'Mean period of swell waves','s'},...
      {'DIRPW',  'Primary wave direction','deg'},...
      {'PERPW',  'Primary wave mean period','s'},...
      {'DIRSW',  'Secondary wave direction','deg'},...
      {'PERSW',  'Secondary wave mean period','s'},...
      {'NSWRS',  'Net short wave (surface)','W/m^2'},...
      {'NLWRS',  'Net long wave (surface)','W/m^2'},...
      {'NSWRT',  'Net short wave (top)','W/m^2'},...
      {'NLWRT',  'Net long wave (top)','W/m^2'},...
      {'LWAVR',  'Long wave','W/m^2'},...
      {'SWAVR',  'Short wave','W/m^2'},...
      {'GRAD',   'Global radiation','W/m^2'},...
      {'var118', 'undefined',''},...
      {'var119', 'undefined',''},...
      {'var120', 'undefined',''},...
      {'LHTFL',  'Latent heat flux','W/m^2'},...
      {'SHTFL',  'Sensible heat flux','W/m^2'},...
      {'BLYDP',  'Boundary layer dissipation','W/m^2'},...
      {'UFLX',   'Zonal momentum flux','N/m^2'},...
      {'VFLX',   'Meridional momentum flux','N/m^2'},...
      {'WMIXE',  'Wind mixing energy','J'},...
      {'IMGD',   'Image data','integer'},...
      {'MSLSA',  'Mean sea level pressure (Std Atm)','Pa'},...
      {'MSLMA',  'Mean sea level pressure (MAPS)','Pa'},...
      {'MSLET',  'Mean sea level pressure (ETA model)','Pa'},...
      {'LFTX',   'Surface lifted index','K'},...
      {'4LFTX',  'Best (4-layer) lifted index','K'},...
      {'KX',     'K index','K'},...
      {'SX',     'Sweat index','K'},...
      {'MCONV',  'Horizontal moisture divergence','kg/kg/s'},...
      {'VSSH',   'Vertical speed shear','1/s'},...
      {'TSLSA',  '3-hr pressure tendency','Pa/s'},...
      {'BVF2',   'Brunt-Vaisala frequency^2','1/s^2'},...
      {'PVMW',   'Potential vorticity (mass-weighted)','1/s/m'},...
      {'CRAIN',  'Categorical rain','1|0'},...
      {'CFRZR',  'Categorical freezing rain','1|0'},...
      {'CICEP',  'Categorical ice pellets','1|0'},...
      {'CSNOW',  'Categorical snow','1|0'},...
      {'SOILW',  'Volumetric soil moisture','fraction'},...
      {'PEVPR',  'Potential evaporation rate','W/m^2'},...
      {'CWORK',  'Cloud work function','J/kg'},...
      {'U-GWD',  'Zonal gravity wave stress','N/m^2'},...
      {'V-GWD',  'Meridional gravity wave stress','N/m^2'},...
      {'PV___',  'Potential vorticity','m^2/s/kg'},...
      {'var150', 'undefined',''},...
      {'var151', 'undefined',''},...
      {'var152', 'undefined',''},...
      {'MFXDV',  'Moisture flux divergence','gr/gr*m/s/m'},...
      {'var154', 'undefined',''},...
      {'GFLUX',  'Ground heat flux','W/m^2'},...
      {'CIN',    'Convective inhibition','J/kg'},...
      {'CAPE',   'Convective Avail. Pot. Energy','J/kg'},...
      {'TKE',    'Turbulent kinetic energy','J/kg'},...
      {'CONDP',  'Lifted parcel condensation pressure','Pa'},...
      {'CSUSF',  'Clear sky upward solar flux','W/m^2'},...
      {'CSDSF',  'Clear sky downward solar flux','W/m^2'},...
      {'CSULF',  'Clear sky upward long wave flux','W/m^2'},...
      {'CSDLF',  'Clear sky downward long wave flux','W/m^2'},...
      {'CFNSF',  'Cloud forcing net solar flux','W/m^2'},...
      {'CFNLF',  'Cloud forcing net long wave flux','W/m^2'},...
      {'VBDSF',  'Visible beam downward solar flux','W/m^2'},...
      {'VDDSF',  'Visible diffuse downward solar flux','W/m^2'},...
      {'NBDSF',  'Near IR beam downward solar flux','W/m^2'},...
      {'NDDSF',  'Near IR diffuse downward solar flux','W/m^2'},...
      {'USTR',   'U wind stress','N/m^2'},...
      {'VSTR',   'V wind stress','N/m^2'},...
      {'MFLX',   'Momentum flux','N/m^2'},...
      {'LMH',    'Mass point model surface','integer'},...
      {'LMV',    'Velocity point model surface','integer'},...
      {'SGLYR',  'Nearby model level','integer'},...
      {'NLAT',   'Latitude','deg'},...
      {'NLON',   'Longitude','deg'},...
      {'UMAS',   'Mass weighted u','gm/m*K*s'},...
      {'VMAS',   'Mass weighted v','gm/m*K*s'},...
      {'XPRATE', 'corrected precip','kg/m^2/s'},...
      {'LPSX',   'x-gradient of log pressure','1/m'},...
      {'LPSY',   'y-gradient of log pressure','1/m'},...
      {'HGTX',   'x-gradient of height','m/m'},...
      {'HGTY',   'y-gradient of height','m/m'},...
      {'STDZ',   'Std dev of Geop. hgt.','m'},...
      {'STDU',   'Std dev of zonal wind','m/s'},...
      {'STDV',   'Std dev of meridional wind','m/s'},...
      {'STDQ',   'Std dev of spec. hum.','gm/gm'},...
      {'STDT',   'Std dev of temp.','K'},...
      {'CBUW',   'Covar. u and omega','m/s*Pa/s'},...
      {'CBVW',   'Covar. v and omega','m/s*Pa/s'},...
      {'CBUQ',   'Covar. u and specific hum','m/s*gm/gm'},...
      {'CBVQ',   'Covar. v and specific hum','m/s*gm/gm'},...
      {'CBTW',   'Covar. T and omega','K*Pa/s'},...
      {'CBQW',   'Covar. spec. hum and omega','gm/gm*Pa/s'},...
      {'CBMZW',  'Covar. v and u','m^2/s^2'},...
      {'CBTZW',  'Covar. u and T','K*m/s'},...
      {'CBTMW',  'Covar. v and T','K*m/s'},...
      {'STDRH',  'Std dev of Rel. Hum.','%'},...
      {'SDTZ',   'Std dev of time tend of geop. hgt','m'},...
      {'ICWAT',  'Ice-free water surface','%'},...
      {'SDTU',   'Std dev of time tend of zonal wind','m/s'},...
      {'SDTV',   'Std dev of time tend of merid wind','m/s'},...
      {'DSWRF',  'Downward solar radiation flux','W/m^2'},...
      {'DLWRF',  'Downward long wave flux','W/m^2'},...
      {'SDTQ',   'Std dev of time tend of spec. hum','gm/gm'},...
      {'MSTAV',  'Moisture availability','%'},...
      {'SFEXC',  'Exchange coefficient','kg*m/m^3/s'},...
      {'MIXLY',  'No. of mixed layers next to sfc','integer'},...
      {'SDTT',   'Std dev of time tend of temp.','K'},...
      {'USWRF',  'Upward solar radiation flux','W/m^2'},...
      {'ULWRF',  'Upward long wave flux','W/m^2'},...
      {'CDLYR',  'Non-convective cloud','%'},...
      {'CPRAT',  'Convective precip. rate','kg/m^2/s'},...
      {'TTDIA',  'Temp. tendency by all physics','K/s'},...
      {'TTRAD',  'Temp. tendency by all radiation','K/s'},...
      {'TTPHY',  'Temp. tendency by nonrad physics','K/s'},...
      {'PREIX',  'Precipitation index','fraction'},...
      {'TSD1D',  'Std dev of IR T over 1x1 deg area','K'},...
      {'NLSGP',  'Natural log of surface pressure','ln(kPa)'},...
      {'SDTRH',  'Std dev of time tend of rel hum','%'},...
      {'5WAVH',  '5-wave geopotential height','gpm'},...
      {'CNWAT',  'Plant canopy surface water','kg/m^2'},...
      {'PLTRS',  'Max. stomato plant resistance','s/m'},...
      {'RHCLD',  'RH-type cloud cover','%'},...
      {'BMIXL',  'Blackadar''s mixing length scale','m'},...
      {'AMIXL',  'Asymptotic mixing length scale','m'},...
      {'PEVAP',  'Pot. evaporation','kg/m^2'},...
      {'SNOHF',  'Snow melt heat flux','W/m^2'},...
      {'SNOEV',  'Snow sublimation heat flux','W/m^2'},...
      {'MFLUX',  'Convective cloud mass flux','Pa/s'},...
      {'DTRF',   'Downward total radiation flux','W/m^2'},...
      {'UTRF',   'Upward total radiation flux','W/m^2'},...
      {'BGRUN',  'Baseflow-groundwater runoff','kg/m^2'},...
      {'SSRUN',  'Storm surface runoff','kg/m^2'},...
      {'var236', 'undefined',''},...
      {'OZONE',  'Total column ozone','Dobson'},...
      {'SNOWC',  'Snow cover','%'},...
      {'SNOT',   'Snow temp.','K'},...
      {'GLCR',   'Permanent snow points','mask'},...
      {'LRGHR',  'Large scale condensation heating','K/s'},...
      {'CNVHR',  'Deep convective heating','K/s'},...
      {'CNVMR',  'Deep convective moistening','kg/kg/s'},...
      {'SHAHR',  'Shallow convective heating','K/s'},...
      {'SHAMR',  'Shallow convective moistening','kg/kg/s'},...
      {'VDFHR',  'Vertical diffusion heating','K/s'},...
      {'VDFUA',  'Vertical diffusion zonal accel','m/s^2'},...
      {'VDFVA',  'Vertical diffusion meridional accel','m/s^2'},...
      {'VDFMR',  'Vertical diffusion moistening','kg/kg/s'},...
      {'SWHR',   'Solar radiative heating','K/s'},...
      {'LWHR',   'Longwave radiative heating','K/s'},...
      {'CD',     'Drag coefficient','non-dim'},...
      {'FRICV',  'Friction velocity','m/s'},...
      {'RI',     'Richardson number','non-dim'},...
      {'var255', 'undefined',''}};


   case 'ECMWF128'

      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      %%   ECMWF user-defined parameter table (#128)         %%
      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      Parameter_Table={...
      {'var0',    'undefined',''},...
      {'None',   'Stream Function ',   'm**2 s**-1'},...
      {'None',   'Velocity Potential',   ' m**2 s**-1'},...
      {'None',   'Potential Temperature ',   'K'},...
      {'None',   'Equivalent Potential Temperature',   ' K'},...
      {'None',   'Saturated Equivalent Potential Temperature',   ' K'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW.',   ' -'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'u-component of Divergent Wind ',   'm s**-1'},...
      {'None',   'v-component of Divergent Wind ',   'm s**-1'},...
      {'None',   'u-component of Rotational Wind ',   'm s**-1'},...
      {'None',   'v-component of Rotational Wind ',   'm s**-1'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'UCTP',   'Unbalanced component of temperature ',   'K'},...
      {'UCLN',   'Unbalanced component of lnsp ',   '-'},...
      {'UCDV',   'Unbalanced component of divergence',   ' s**-1'},...
      {'None',   'Reserved for future unbalanced components',   ' -'},...
      {'None',   'Reserved for future unbalanced components ',   '-'},...
      {'CL',   'Lake cover ',   '(0-1)'},...
      {'CVL',   'Low vegetation cover ',   '(0-1)'},...
      {'CVH',   'High vegetation cover ',   '(0-1)'},...
      {'TVL',   'Type of low vegetation ',   '-'},...
      {'TVH',   'Type of high vegetation ',   '-'},...
      {'CI',   'Sea ice cover ',   '(0-1)'},...
      {'ASN',   'Snow albedo ',   '(0-1)'},...
      {'RSN',   'Snow density ',   'kg**-3'},...
      {'SSTK',   'Sea surface temperature (absolute) ',   'K'},...
      {'ISTL1',   'Ice surface temperature layer 1 ',   'K'},...
      {'ISTL2',   'Ice surface temperature layer 2 ',   'K'},...
      {'ISTL3',   'Ice surface temperature layer 3 ',   'K'},...
      {'ISTL4',   'Ice surface temperature layer 4 ',   'K'},...
      {'SWVL1',   'Volumetric soil water layer 1 ',   'm**3 m**-3'},...
      {'SWVL2',   'Volumetric soil water layer 2 ',   'm**3 m**-3'},...
      {'SWVL3',   'Volumetric soil water layer 3 ',   'm**3 m**-3'},...
      {'SWVL4',   'Volumetric soil water layer 4 ',   'm**3 m**-3'},...
      {'SLT',   'Soil Type ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'AT',   'Atmospheric tide ',   '-'},...
      {'BV',   'Budget values ',   '-'},...
      {'Z',   'Geopotential (at the surface = orography) ',   'm**2 s**-2'},...
      {'T',   'Temperature ',   'K'},...
      {'U',   'U-velocity ',   'm s**-1'},...
      {'V',   'V-velocity ',   'm s**-1'},...
      {'Q',   'Specific humidity ',   'kg kg**-1'},...
      {'SP',   'Surface pressure ',   'Pa'},...
      {'W',   'Vertical velocity ',   'Pa s**-1'},...
      {'TWC',   'Total column water ',   'kg m**-2'},...
      {'PWC',   'Precipitable water content ',   'kg m**-2'},...
      {'VO',   'Vorticity (relative) ',   's**-1'},...
      {'ST',   'Surf.temp/soil temp lev 1 (from 930804) ',   'K'},...
      {'SSW',   'Surf soil wet/soil wet lev 1(from 930803) ',   'm (of water)'},...
      {'SD',   'Snow depth ',   'm (of water equivalent)'},...
      {'LSP',   'Large scale precipitation ',   'm'},...
      {'CP',   'Convective precipitation ',   'm'},...
      {'SF',   'Snow fall ',   'm(of water equivalent)'},...
      {'BLD',   'Boundary layer dissipation ',   'W m**-2 s'},...
      {'SSHF',   'Surface sensible heat flux ',   'W m**-2 s'},...
      {'SLHF',   'Surface latent heat flux ',   'W m**-2 s'},...
      {'SS/CHNK',   'Surface stress/Charnock (from 980519) ',   '-'},...
      {'SNR',   'Surface net radiation ',   '-'},...
      {'AIW',   'Top net radiation ',   '-'},...
      {'MSL',   'Mean sea level pressure ',   'Pa'},...
      {'LNSP',   'Log surface pressure ',   '-'},...
      {'SWHR',   'Short wave heating rate ',   'K'},...
      {'LWH',   'Long wave heating rate ',   'K'},...
      {'D',   'Divergence ',   's**-1'},...
      {'GH',   'Height (geopotential) ',   'm'},...
      {'R',   'Relative humidity ',   '%'},...
      {'TSP',   'Tendency of surface pressure ',   'Pa s**-1'},...
      {'BLH',   'Boundary layer height ',   'm'},...
      {'SDOR',   'Standard deviation of orography ',   '-'},...
      {'ISOR',   'Anisotropy of subgrid scale orography ',   '-'},...
      {'ANOR',   'Angle of subgrid scale orography ',   '-'},...
      {'SLOR',   'Slope of subgrid scale orography ',   '-'},...
      {'TCC',   'Total cloud cover ',   '(0 - 1)'},...
      {'10U',   '10 metre u wind component ',   'm s**-1'},...
      {'10V',   '10 metre v wind component ',   'm s**-1'},...
      {'2T',   '2 metre temperature ',   'K'},...
      {'2D',   '2 metre dewpoint temperature ',   'K'},...
      {'SSRD',   'Surface solar radiation downwards',   ' W m**-2 s'},...
      {'DST',   'Deep soil tmp/soil temp lev2(from 930804) ',   'K'},...
      {'DSW',   'Deep soil wet/soil wet lev2(from 930803) ',   'm (of water)'},...
      {'LSM',   'Land/sea mask ',   '(0-1)'},...
      {'SR',   'Surface roughness ',   'm'},...
      {'AL',   'Albedo ',   '-'},...
      {'STRD',   'Surface thermal radiation downwards',   ' W m**-2 s'},...
      {'SSR',   'Surface solar radiation ',   'W m**-2 s'},...
      {'STR',   'Surface thermal radiation',   ' W m**-2 s'},...
      {'TSR',   'Top solar radiation ',   'W m**-2 s'},...
      {'TTR',   'Top thermal radiation ',   'W m**-2 s'},...
      {'EWSS',   'East/West surface stress ',   'N m**-2 s'},...
      {'NSSS',   'North/South surface stress ',   'N m**-2 s'},...
      {'E',   'Evaporation ',   'm (of water)'},...
      {'CDST',   'Clim deep soil tmp/soil tmp lev3(930804) ',   'K'},...
      {'CDSW',   'Clim deep soil wet/soil wet lev3(930803) ',   'm (of water)'},...
      {'CCC',   'Convective cloud cover ',   '(0 - 1)'},...
      {'LCC',   'Low cloud cover ',   '(0 - 1)'},...
      {'MCC',   'Medium cloud cover ',   '(0 - 1)'},...
      {'HCC',   'High cloud cover ',   '(0 - 1)'},...
      {'-',   'Unused ',   '-'},...
      {'EWOV',   'EW component subgrid orographic variance ',   'm**2'},...
      {'NSOV',   'NS component subgrid orographic variance ',   'm**2'},...
      {'NWOV',   'NWSE component subgrid orographic variance ',   'm**2'},...
      {'NEOV',   'NESW component subgrid orographic variance ',   'm**2'},...
      {'BTMP',   'Brightness temperature ',   'K'},...
      {'LGWS',   'Lat. component of gravity wave stress ',   'N m**-2 s'},...
      {'MGWS',   'Meridional component gravity wave stress ',   'N m**-2 s'},...
      {'GWD',   'Gravity wave dissipation ',   'W m**-2 s'},...
      {'SRC',   'Skin reservoir content ',   'm (of water)'},...
      {'VEG',   'Percentage of vegetation ',   '%'},...
      {'VSO',   'Variance of sub-grid scale orography ',   'm**2'},...
      {'MX2T',   'Max 2m temp since previous post-processing',   ' K'},...
      {'MN2T',   'Min 2m temp since previous post-processing ',   'K'},...
      {'O3',   'Ozone mass mixing ratio ',   'kg kg**-1'},...
      {'PAW',   'Precip. analysis weights ',   '-'},...
      {'RO',   'Runoff* ',   'm'},...
      {'TCO3',   'Total column ozone Dobson ',   '(kg m**-2)'},...
      {'10SI',   '10m. Windspeed (irresp of dir.) ',   'm s**-1'},...
      {'TSRC',   'Top net solar radiation clear sky ',   'W m**-2'},...
      {'TTRC',   'Top upward thermal radiation clear sky ',   'W m**-2'},...
      {'SSRC',   'Surface net solar radiation clear sky ',   'W m**-2'},...
      {'STRC',   'Surface net thermal radiation clear sky ',   'W m**-2'},...
      {'SI',   'Solar insulation ',   'W m**-2'},...
      {'-',   'Unused ',   '-'},...
      {'DHR',   'Diabatic heating by radiation* ',   'K'},...
      {'DHVD',   'Diabatic heating by vertical diffusion ',   'K'},...
      {'DHCC',   'Diabatic heating by cumulus convection ',   'K'},...
      {'DHLC',   'Diabatic heating large-scale condensation ',   'K'},...
      {'VDZW',   'Vertical diffusion of zonal wind ',   'm s**-1'},...
      {'VDMW',   'Vertical diffusion of meridional wind ',   'm s**-1'},...
      {'EWGD',   'EW gravity wave drag ',   'm s**-1'},...
      {'NSGD',   'NS gravity wave drag ',   'm s**-1'},...
      {'CTZW',   'Convective tendency of zonal wind ',   'm s**-1'},...
      {'CTMW',   'Convective tendency of meridional wind ',   'm s**-1'},...
      {'VDH',   'Vertical diffusion of humidity ',   'kg kg**-1'},...
      {'HTCC',   'Humidity tendency by cumulus convection ',   'kg kg**-1'},...
      {'HTLC',   'Humidity tendency large-scale condensation ',   'kg kg**-1'},...
      {'CRNH',   'Change from removing negative humidity ',   'kg/kg s-1'},...
      {'TP',   'Total precipitation ',   'm'},...
      {'IEWS',   'Instantaneous X surface stress ',   'N m**-2'},...
      {'INSS',   'Instantaneous Y surface stress ',   'N m**-2'},...
      {'ISHF',   'Instantaneous surface Heat Flux ',   'W m**-2'},...
      {'IE',   'Instantaneous Moisture Flux (evaporation)',   ' kg m**-2 s'},...
      {'ASQ',   'Apparent Surface Humidity ',   'kg kg**-1'},...
      {'LSRH',   'Log of surface roughness length for heat ',   '-'},...
      {'SKT',   'Skin Temperature ',   'K'},...
      {'STL4',   'Soil temperature level 4 ',   'K'},...
      {'SWL4',   'Soil wetness level 4 ',   'm'},...
      {'TSN',   'Temperature of snow layer ',   'K'},...
      {'CSF',   'Convective snow-fall ',   'm (of water equivalent)'},...
      {'LSF',   'Large scale snow-fall ',   'm (of water equivalent)'},...
      {'ACF',   'Accumulated cloud fraction tendency ',   '(-1 to 1)'},...
      {'ALW',   'Accumulated liquid water tendency ',   '(-1 to 1)'},...
      {'FAL',   'Forecast albedo ',   '-'},...
      {'FSR',   'Forecast surface roughness ',   'm'},...
      {'FLSR',   'Forecast log of surface roughness for heat ',   '-'},...
      {'CLWC',   'Cloud liquid water content ',   'kg kg**-1'},...
      {'CIWC',   'Cloud ice water content ',   'kg kg**-1'},...
      {'CC',   'Cloud cover ',   '(0 - 1)'},...
      {'AIW',   'Accumulated ice water tendency ',   '(-1 to 1)'},...
      {'ICE',   'Ice Age ',   '(0 first-year 1 multi-year)'},...
      {'ATTE',   'Adiabatic tendency of temperature ',   'K'},...
      {'ATHE',   'Adiabatic tendency of humidity ',   'kg kg**-1'},...
      {'ATZE',   'Adiabatic tendency of zonal wind ',   'm s**-1'},...
      {'ATMW',   'Adiabatic tendency of meridional wind ',   'm s**-1'},...
      {'-',   'Indicates a missing value ',   '-'}};

   case 'ECMWF160'

      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      %%   ECMWF user-defined parameter table (#160)         %%
      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      Parameter_Table={...
      {'var0',    'undefined',''},...
      {'None',   'Stream Function ',   'm**2 s**-1'},...
      {'None',   'Velocity Potential',   ' m**2 s**-1'},...
      {'None',   'Potential Temperature ',   'K'},...
      {'None',   'Equivalent Potential Temperature',   ' K'},...
      {'None',   'Saturated Equivalent Potential Temperature',   ' K'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW.',   ' -'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'u-component of Divergent Wind ',   'm s**-1'},...
      {'None',   'v-component of Divergent Wind ',   'm s**-1'},...
      {'None',   'u-component of Rotational Wind ',   'm s**-1'},...
      {'None',   'v-component of Rotational Wind ',   'm s**-1'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'None',   'RESERVED FOR METVIEW. ',   '-'},...
      {'UCTP',   'Unbalanced component of temperature ',   'K'},...
      {'UCLN',   'Unbalanced component of lnsp ',   '-'},...
      {'UCDV',   'Unbalanced component of divergence',   ' s**-1'},...
      {'None',   'Reserved for future unbalanced components',   ' -'},...
      {'None',   'Reserved for future unbalanced components ',   '-'},...
      {'CL',   'Lake cover ',   '(0-1)'},...
      {'CVL',   'Low vegetation cover ',   '(0-1)'},...
      {'CVH',   'High vegetation cover ',   '(0-1)'},...
      {'TVL',   'Type of low vegetation ',   '-'},...
      {'TVH',   'Type of high vegetation ',   '-'},...
      {'CI',   'Sea ice cover ',   '(0-1)'},...
      {'ASN',   'Snow albedo ',   '(0-1)'},...
      {'RSN',   'Snow density ',   'kg**-3'},...
      {'SSTK',   'Sea surface temperature (absolute) ',   'K'},...
      {'ISTL1',   'Ice surface temperature layer 1 ',   'K'},...
      {'ISTL2',   'Ice surface temperature layer 2 ',   'K'},...
      {'ISTL3',   'Ice surface temperature layer 3 ',   'K'},...
      {'ISTL4',   'Ice surface temperature layer 4 ',   'K'},...
      {'SWVL1',   'Volumetric soil water layer 1 ',   'm**3 m**-3'},...
      {'SWVL2',   'Volumetric soil water layer 2 ',   'm**3 m**-3'},...
      {'SWVL3',   'Volumetric soil water layer 3 ',   'm**3 m**-3'},...
      {'SWVL4',   'Volumetric soil water layer 4 ',   'm**3 m**-3'},...
      {'SLT',   'Soil Type ',   '-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'-','Unused ','-'},...
      {'AT',   'Atmospheric tide ',   '-'},...
      {'BV',   'Budget values ',   '-'},...
      {'Z',   'Geopotential (at the surface = orography) ',   'm**2 s**-2'},...
      {'T',   'Temperature ',   'K'},...
      {'U',   'U-velocity ',   'm s**-1'},...
      {'V',   'V-velocity ',   'm s**-1'},...
      {'Q',   'Specific humidity ',   'kg kg**-1'},...
      {'SP',   'Surface pressure ',   'Pa'},...
      {'W',   'Vertical velocity ',   'Pa s**-1'},...
      {'-',   'Unused ',   '-'},...
      {'PWC',   'Precipitable water content ',   'kg m**-2'},...
      {'VO',   'Vorticity (relative) ',   's**-1'},...
      {'STL1',   'Soil temperature level 1 ',   'K'},...
      {'SWL1',   'Soil wetness level 1 ',   'm'},...
      {'SD',   'Snow depth ',   'm (of water)'},...
      {'LSP',   'Large scale precipitation ',   'kg m**-2 s**-1'},...
      {'CP',   'Convective precipitation ',   'kg m**-2 s**-1'},...
      {'SF',   'Snow fall ',   'kg m**-2 s**-1'},...
      {'BLD',   'Boundary layer dissipation ',   'W m**-2 s'},...
      {'SSHF',   'Surface sensible heat flux ',   'W m**-2 s'},...
      {'SLHF',   'Surface latent heat flux ',   'W m**-2 s'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'MSL', 'Mean sea level pressure','Pa'},...
      {'LNSP','Ln surface pressure', ' -'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'D','Divergence s**-1'},...
      {'GH','Height (geopotential)','m'},...
      {'R','Relative humidity','(0 - 1)'},...
      {'TSP','Tendency of surface pressure ','Pa s**-1'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'TCC','Total cloud cover ','(0 - 1)'},...
      {'10U','10 metre u wind component',' m s**-1'},...
      {'10V','10 metre v wind component ','m s**-1'},...
      {'2T','2 metre temperature ','K'},...
      {'2D','2 metre dewpoint temperature',' K'},...
      {'-',   'Unused ',   '-'},...
      {'STL2','Soil temperature level 2 ','K'},...
      {'SWL2','Soil wetness level 2 ','m'},...
      {'LSM','Land/sea mask ','(0 - 1)'},...
      {'SR','Surface roughness ','m'},...
      {'AL','Albedo ','(0 - 1)'},...
      {'-',   'Unused ',   '-'},...
      {'SSR','Surface solar radiation ','W m**-2'},...
      {'STR','Surface thermal radiation ','W m**-2'},...
      {'TSR','Top solar radiation ','W m**-2'},...
      {'TTR','Top thermal radiation ','W m**-2'},...
      {'EWSS','East/west surface stress',' N m**-2 s**-1'},...
      {'NSSS','North/south surface stress ','N m**-2 s**-1'},...
      {'E','Evaporation ','kg m**-2 s**-1'},...
      {'STL3','Soil temperature level 3 ','K'},...
      {'SWL3','Soil wetness level 3 ','m'},...
      {'CCC','Convective cloud cover ','(0 - 1)'},...
      {'LCC','Low cloud cover ','(0 - 1)'},...
      {'MCC','Medium cloud cover ','(0 - 1)'},...
      {'HCC','High cloud cover ','(0 - 1)'},...
      {'-',   'Unused ',   '-'},...
      {'EWOV','EW component of sub-grid scale orographic variance',' m**2'},...
      {'NSOV','NS component of sub-grid scale orographic variance',' m**2'},...
      {'NWOV','NWSE component sub-grid scale orographic variance ','m**2'},...
      {'NEOV','NESW component sub-grid scale orographic variance',' m**2'},...
      {'-',   'Unused ',   '-'},...
      {'LGWS','Latitudinal component of gravity wave stress ','N m**-2 s'},...
      {'MGWS','Meridional component of gravity wave stress ','N m**-2 s'},...
      {'GWD','Gravity wave dissipation',' W m**-2 s'},...
      {'SRC','Skin reservoir content ','m (of water)'},...
      {'VEG','Percentage of vegetation ','%'},...
      {'VSO','Variance of sub-grid scale orography ','m**2'},...
      {'MX2T','Max temp.2m during averaging time ','K'},...
      {'MN2T','Min temp.2m during averaging time',' K'},...
      {'-',   'Unused ',   '-'},...
      {'PAW','Precip. analysis weights ','-'},...
      {'RO','Runoff ','kg m**-2 s**-1'},...
      {'ZZ','St.Dev. of Geopotential ','m**2 s**-2'},...
      {'TZ','Covar Temp & Geopotential',' K m**2 s**-2'},...
      {'TT','St.Dev. of Temperature',' K'},...
      {'QZ','Covar Sp.Hum. & Geopotential',' m**2 s**-2'},...
      {'QT','Covar Sp.Hum & Temp. ','K'},...
      {'QQ','St.Dev. of Specific humidity ','(0 - 1)'},...
      {'UZ','Covar U-comp. & Geopotential',' m**3 s**-3'},...
      {'UT','Covar U-comp. & Temp.',' K m s**-1'},...
      {'UQ','Covar U-comp. & Sp.Hum.',' m s**-1'},...
      {'UU','St.Dev. of U-velocity ','m s**-1'},...
      {'VZ','Covar V-comp. & ','Geopotential m**3 s**-3'},...
      {'VT','Covar V-comp. & Temp.',' K m s**-1'},...
      {'VQ','Covar V-comp. & Sp.Hum.',' m s**-1'},...
      {'VU','Covar V-comp. & U-comp ','m**2 s**-2'},...
      {'VV','St.Dev. of V-comp',' m s**-1'},...
      {'WZ','Covar W-comp. & Geopotential ','Pa m**2 s**-3'},...
      {'WT','Covar W-comp. & Temp.',' K Pa s**-1'},...
      {'WQ','Covar W-comp. & Sp.Hum.',' Pa s**-1'},...
      {'WU','Covar W-comp. & U-comp.',' Pa m s**-2'},...
      {'WV','Covar W-comp. & V-comp.',' Pa m s**-2'},...
      {'-',   'Unused ',   '-'},...
      {'WW','St.Dev. of Vertical velocity Pa s**-1'},...
      {'-',   'Unused ',   '-'},...
      {'TP','Total precipitation','m'},...
      {'IEWS','Instantaneous X surface stress','N m**-2'},...
      {'INSS','Instantaneous Y surface stress','N m**-2'},...
      {'ISHF','Instantaneous surface Heat Flux','W m**-2'},...
      {'IE','Instantaneous Moisture Flux (evaporation)','kg m**-2 s**-1'},...
      {'ASQ','Apparent Surface Humidity ','kg kg**-1'},...
      {'LSRH','Logarithm of surface roughness length for heat','-'},...
      {'SKT','Skin Temperature','K'},...
      {'STL4','Soil temperature level 4 ','K'},...
      {'SWL4','Soil wetness level 4 ','m'},...
      {'TSN','Temperature of snow layer ','K'},...
      {'CSF','Convective snow-fall ','kg m**-2 s**-1'},...
      {'LSF','Large scale snow-fall ','kg m**-2 s**-1'},...
      {'CLWC','Cloud liquid water content ','kg kg**-1'},...
      {'CC','Cloud cover (at given level) ','(0 - 1)'},...
      {'FAL','Forecast albedo ','-'},...
      {'FSR','Forecast surface roughness ','m'},...
      {'FLSR','Forecast logarithm of surface roughness for heat. ','-'},...
      {'10WS','10m. Windspeed (irresp of dir.) ','m s**-1'},...
      {'MOFL','Momentum flux (irresp of dir.) ','N m**-2'},...
      {'HSD','Heaviside ("beta") function','(0 - 1)'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'},...
      {'-',   'Unused ',   '-'}};
   otherwise,
      error('Invalid parameter table specification.')
end

   




    
    
    
    
    
    



@


1.1
log
@Initial revision
@
text
@d64 1
a64 1
rgversiondate=datenum(2004,4,1);
d66 2
a67 2
if nargin==0,grib_struct=[];gribhelp('mainhelp');return,end
if nargin==1,grib_struct=[];gribhelp(gribname);return,end
d298 2
a299 1
      grib_struct(crec).parameter=[pds_struct.parameter ' [' temp3 ']'];
a300 1
      % 14 Jun 2002: BOB: added level to output struct
d303 1
d454 2
a455 1
bds_struct.RefVal=ibm2fltmex5(bds(7:10));
d548 9
a556 2
[layerstr,layerabbrev]=table3a(pds(10));%indicator of type of level of layer, table 3 & 3a
pds_struct.layer=[int2str(pds(10)) ' - ' layerstr ' [' layerabbrev ']'];
d679 1
d691 12
a702 14
%           100 Isobaric surface Pressure in hPa (2 octets)
%           101 Layer between two isobaric surfaces Pressure of top in kPa Pressure of bottom in kPa
%           102 Mean sea level  0
%           103 Specified altitude above mean sea level  Altitude in meters (2 octets)
%           104 Layer between two specified altitudes
%                above mean sea level Altitude of top in hm Altitude of bottom in hm
%           105 Specified height above ground Height in meters (2 octets)
%           106 Layer between two specified height
%                levels above ground Height of top in hm Height of bottom in hm
%           107 Sigma level Sigma value in 1/10000 (2 octets)
%           108 Layer between two sigma levels Sigma value of top in 1/100 Sigma value of bottom in 1/100
%           109 Hybrid level Level number (2 octets)
%           110 Layer between two hybrid levels Level number of top Level number of bottom 
%           111 Departmenth below land surface Departmenth in centimeters (2 octets)   
a820 49
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% int3                                                      %
%                                                           %
% BOB 6 Sept 2002:  MATLAB6.5 (R13) has an improved         %
% HEX2DEC function that actually forces the input to        %
% be a string. Hence, the call hex2dec(80) causes an        %
% error in R13. The lack of an error in previous            %
% versions was fortuitous since the (unnecessary)           %
% logic in the lines                                        %
%                                                           %
% sgn=1;                                                    %
% tmp=dec2bin(a,8);if strcmp(tmp(1),'1'),sgn=-1;,end        %
%                                                           %
% essentially negated the effect of the  hex2dec(80) call.  %
%                                                           %
% Therefore, the line                                       %
%  retval=sgn*((1-(bitshift(bitand(a,hex2dec(80)),-6)))*... %
%  (bitshift(bitand(a,127),16)+(bitshift(b,8)+c)));         %
%                                                           %
% has been replaced with the line below, since              %
% hex2dec('80')=128                                         %
%                                                           %
% The same problem exists in the routine int2 below,        %
% and is similarly fixed.                                   %
%                                                           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function retval=int3(a,b,c)     
retval=(1-(bitshift(bitand(a,128),-6)))*(bitshift(bitand(a,127),16)+(bitshift(b,8)+c));    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% int2                                              %
%                                                   %
% See notes above in int3.                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function retval=int2(a,b)                                                      
retval=((1-(bitshift(bitand(a,128),-6)))*(bitshift(bitand(a,127),8)+b)); 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% bitshift3                                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function retval=bitshift3(a,b,c)
retval=bitshift(a,16) + bitshift(b,8) +c;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% bitshift2                                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function retval=bitshift2(a,b)   
retval=bitshift(a,8) +b;

d830 25
a854 26
      str=[];
      str=[str sprintf('READ_GRIB is a set of MATLAB functions to process weather\n')];
      str=[str sprintf('model output files, distributed in the WMO GRiB format.  This\n')];
      str=[str sprintf('format is a very compact, machine independent binary that\n')];
      str=[str sprintf('allows exchange of meteorological model products around\n')];
      str=[str sprintf('the modeling community.\n')];
      str=[str sprintf('\n')];
      str=[str sprintf('The general procedure is to inventory a GRiB file with\n')];
      str=[str sprintf('read_grib(gribname,''invent'') to identify which records are to\n')];
      str=[str sprintf('be extracted.  Then, use READ_GRIB to extract specific\n')];
      str=[str sprintf('records.  Alternatively, READ_GRIB can accept a list of\n')];
      str=[str sprintf('parameter names to extract, by using read_grib(gribname,list)\n')];
      str=[str sprintf('where list is a cell array containing parameter names.\n')];
      str=[str sprintf('For example, read_grib("grib_file",{''UFLX'',''VFLX'',''PRES''},...) \n')];
      str=[str sprintf('will extract from the GRiB file "grib_file" the records \n')];
      str=[str sprintf('that have parameter names UFLX, VFLX, and PRES. Be \n')];
      str=[str sprintf('advised that more than one GRiB record can have the same \n')];
      str=[str sprintf('parameter NAME, as the pressure denoted by the parameter \n')];
      str=[str sprintf('name PRES can be provided at several atmospheric levels.\n')];
      str=[str sprintf('\n')];
      str=[str sprintf('Extraction by other GRiB information is not yet possible.\n')];
      str=[str sprintf('\n')];
      
      str=[str sprintf('Call READ_GRIB with the following "help" arguments for more\n')];
      str=[str sprintf('information:\n')];
      str=[str sprintf('''mainhelp'',''paramtableshort'',''paramtablelong'',''output_struct''\n')];
@
